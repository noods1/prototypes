import{r as t,c as e,h as i,H as s,a,F as o}from"./p-BVbYP5UG.js";import{c as l}from"./p-BLeWSNPN.js";import{S as r}from"./p-DtH7945i.js";import{b as n,d,t as c,j as h}from"./p-B9Bv72kO.js";import{i as u}from"./p-DATBQMev.js";import{u as f}from"./p-CZoCRgNL.js";import"@oddbird/popover-polyfill";import"./p-B85MJLTf.js";import"./p-BpTTFEEs.js";function p(t,e){const i=`cannot ${t.method} ${t.action} ${e.status}'`;const s=new Error(i);s.status=e.status;s.method=t.method;s.url=t.action;return s}function m(t){const e=t.responseText||t.response;if(!e){return e}try{return JSON.parse(e)}catch(t){return e}}function b(t){const e=new XMLHttpRequest;if(t.onProgress&&e.upload){e.upload.onprogress=function e(i){if(i.total>0){i.percent=i.loaded/i.total*100}t.onProgress(i)}}const i=new FormData;if(t.data){Object.keys(t.data).forEach((e=>{const s=t.data[e];if(Array.isArray(s)){s.forEach((t=>{i.append(`${e}[]`,t)}));return}i.append(e,s)}))}if(t.file instanceof Blob){i.append(t.filename,t.file,t.file.name)}else{i.append(t.filename,t.file)}e.onerror=function e(i){t?.onError&&t.onError(i)};e.onload=function i(){if(e.status<200||e.status>=300){return t.onError&&t.onError(p(t,e),m(e))}return t.onSuccess(m(e),e)};e.open(t.method,t.action,true);if(t.withCredentials&&"withCredentials"in e){e.withCredentials=true}const s=t.headers||{};if(s["X-Requested-With"]!==null){e.setRequestHeader("X-Requested-With","XMLHttpRequest")}Object.keys(s).forEach((t=>{if(s[t]!==null){e.setRequestHeader(t,s[t])}}));e.send(i);return{abort(){e.abort()}}}function k(t,e){const i=[...e];const s=i.findIndex((({uid:e})=>e===t.uid));if(s===-1){i.push(t)}else{i[s]=t}return i}function _(t){return{...t,lastModified:t.lastModified,lastModifiedDate:t.lastModifiedDate,name:t.name,size:t.size,type:t.type,uid:t.uid,percent:0,originFileObj:t}}function g(t,e){const i=t.uid!==undefined?"uid":"name";const s=e.filter((e=>e[i]!==t[i]));if(s.length===e.length){return null}return s}function v(t,e){if(t&&e){const i=Array.isArray(e)?e:e.split(",");const s=t.name||"";const a=t.type||"";const o=a.replace(/\/.*$/,"");return i.some((t=>{const e=t.trim();if(/^\*(\/\*)?$/.test(t)){return true}if(e.startsWith(".")){const t=s.toLowerCase();const i=e.toLowerCase();let a=[i];if(i===".jpg"||i===".jpeg"){a=[".jpg",".jpeg"]}return a.some((e=>t.endsWith(e)))}if(e.endsWith("/*")){return o===e.replace(/\/.*$/,"")}if(a===e){return true}if(/^\w+$/.test(e)){return true}return false}))}return true}var x=undefined&&undefined.__decorate||function(t,e,i,s){var a=arguments.length,o=a<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s,l;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)if(l=t[r])o=(a<3?l(o):a>3?l(e,i,o):l(e,i))||o;return a>3&&o&&Object.defineProperty(e,i,o),o};const y="rc-upload";const w=class{constructor(i){t(this,i);this.ksChange=e(this,"ksChange",1);this["ks-name"]="ks-rc-upload";this.uid=n();this.reqs={};this.name="file";this.disabled=false;this.multiple=false;this.method="post";this.fileListLength=0;this.processFile=async(t,e)=>{let i=t;if(this.beforeUpload){let s;try{s=await this.beforeUpload(t,e)}catch(t){s=false}if(s===false){return{origin:t,parsedFile:null,action:null,data:null}}else{i=s}}const{action:s}=this;let a;if(typeof s==="function");else{a=s}const{data:o}=this;let l;if(typeof o==="function"){l=await o(i)}else{l=o}let r;if(i instanceof File){r=i}else{r=new File([i],t.name,{type:t.type})}const n=r;n.uid=t.uid;return{origin:t,data:l,parsedFile:n,action:a}};this.onTrigger=()=>{if(this.disabled){return}this.fileInput.click()};this.onFileDrop=t=>{t.preventDefault();let e=[...t.dataTransfer.files].filter((t=>v(t,this.accept)));if(!this.multiple){e=e.slice(0,1)}if(e.length===0){this.onfail?.(new CustomEvent("onfail",{bubbles:false,composed:false,detail:{error:"file accept err",response:"error",file:e}}))}this.uploadFiles(e)};this.uploadChange=t=>{this.uploadFiles(t.target.files)}}handleUpdate(){this.children.forEach((t=>{t.disabled=this.disabled}))}uploadFiles(t){const e=u(this.maxLength)?[...t].slice(0,this.maxLength-this.fileListLength):[...t];if(u(this.maxLength)&&this.fileListLength+t.length>this.maxLength){this.onfail?.(new CustomEvent("onfail",{bubbles:false,composed:false,detail:{error:"upload_exceeded_max_limit",response:"upload_exceeded_max_limit",file:t}}))}const i=e.map((t=>{t.uid=n();return this.processFile(t,e)}));Promise.all(i).then((t=>{t.filter((t=>t.parsedFile!==null)).forEach((t=>{this.post(t)}))})).finally((()=>{this.clearInputValue()}))}post({data:t,origin:e,action:i,parsedFile:s}){const{name:a,headers:o,method:l}=this;const{uid:r}=e;const n=this.customRequest||b;const d={action:i,filename:a,data:t,file:s,headers:o,method:l,onProgress:t=>{this.onpro?.(new CustomEvent("onpro",{bubbles:false,composed:false,detail:{event:t,file:s}}))},onSuccess:(t,e)=>{this.onsuccess?.(new CustomEvent("onsuccess",{bubbles:false,composed:false,detail:{response:t,file:s,xhr:e}}));delete this.reqs[r]},onError:(t,e)=>{this.onfail?.(new CustomEvent("onfail",{bubbles:false,composed:false,detail:{error:t,response:e,file:s}}))}};this.reqs[r]=n(d)}async abort(t){const{reqs:e}=this;if(t){const i=t.uid?t.uid:t;if(e[i]&&e[i].abort){e[i].abort()}delete e[i]}else{Object.keys(e).forEach((t=>{if(e[t]&&e[t].abort){e[t].abort()}delete e[t]}))}}componentWillLoad(){this.children.forEach((t=>{t.disabled=this.disabled}))}async clearInputValue(){this.fileInput.value=""}render(){return i(s,{key:"603ce475c34cafc5546f993e75b1843ad1b5a824",dir:d(),"ks-rc-upload":true},i("span",{key:"c822ed993bddf80ff86723fdd3ecb380c821e43f",dir:d(),class:l(y),part:"self",onClick:this.onTrigger,onDrop:this.onFileDrop,"data-testid":"rc-upload-rc-upload-8JzfyY"},i("input",{key:"c6f06795c8143e0572805ddc996cae013ff62d13",part:"upload",type:"file",accept:this.accept,ref:t=>this.fileInput=t,onClick:t=>t.stopPropagation(),style:{display:"none"},multiple:this.multiple,disabled:this.disabled,onChange:this.uploadChange,"data-testid":"rc-upload-rc-upload-rrbezU"}),i("slot",{key:"8007531bb372660b37a5ba5841fdad8f68915bdf"})))}get el(){return a(this)}static get watchers(){return{disabled:["handleUpdate"]}}};x([r({slotname:"_default"})],w.prototype,"children",void 0);const S=":host{display:block;width:100%}.upload{display:flex;flex-direction:column}.upload__file-list{display:block;margin-top:var(--ks-spacing-200)}.upload [ks-rc-upload]{display:inline-block;width:100%}.upload [ks-rc-upload] [ks-text]{display:block;margin-top:var(--ks-spacing-100)}.upload [ks-rc-upload] [ks-text] span{color:var(--ks-color-neutral-onSurface);transition:0.1s}.upload [ks-rc-upload] [ks-text] .disabled{color:var(--ks-color-neutral-onSurfaceDisabled)}.upload [ks-rc-upload]:hover [ks-text] span:not(.disabled){color:var(--ks-color-neutral-onSurfaceHover)}.upload [ks-rc-upload]:active [ks-text] span:not(.disabled){color:var(--ks-color-neutral-onSurfaceActive)}.upload__message{color:var(--ks-color-neutral-onSurface);font-size:var(--ks-text-bodySm-fontSize);line-height:var(--ks-text-bodySm-lineHeight);margin-top:var(--ks-spacing-100)}.upload__message--error{color:var(--ks-color-error-onSurface)}";var z=undefined&&undefined.__decorate||function(t,e,i,s){var a=arguments.length,o=a<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,i):s,l;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")o=Reflect.decorate(t,e,i,s);else for(var r=t.length-1;r>=0;r--)if(l=t[r])o=(a<3?l(o):a>3?l(e,i,o):l(e,i))||o;return a>3&&o&&Object.defineProperty(e,i,o),o};const j="upload";const $=class{constructor(i){t(this,i);this.ksChange=e(this,"ksChange",1);this.ksError=e(this,"ksError",1);this.exceededMaxChange=e(this,"exceededMaxChange",1);this["ks-name"]="ks-upload";this.size="md";this.name="file";this.disabled=false;this.multiple=false;this.method="post";this.fileList=[];this.defaultFileList=[];this.showUploadList=true;this.type="select";this.message="";this.description="";this.showMessage=false;this.mergedFileList=[];this.highlight=false;this.isError=false;this.isExceededMax=false;this.errorMessage="";this.onInternalChange=(t,e,i)=>{this.mergedFileList=[...e];const s={file:t,fileList:this.mergedFileList};if(i){s.event=i}if(s.fileList.length===0){this.uploadEl.clearInputValue()}this.ksChange?.emit(s)};this.onSuccess=({detail:{response:t,file:e,xhr:i}})=>{this.isError=false;const s=_(e);s.status="done";s.percent=100;s.response=t;s.xhr=i;const a=this.multiple?k(s,this.mergedFileList):[s];this.onInternalChange(s,a)};this.onProgress=({detail:{event:t,file:e}})=>{this.isError=false;const i=_(e);i.status="uploading";i.percent=t.percent;const s=this.multiple?k(i,this.mergedFileList):[i];this.onInternalChange(i,s)};this.onFail=t=>{const{detail:{event:e,file:i,error:s,response:a}}=t;if(s){this.ksError.emit({file:i,fileList:[],error:s});this.isError=true;if(s==="upload_exceeded_max_limit"){this.isExceededMax=true;return}}const o=_(i);o.status="error";o.percent=e?.percent||0;o.response=a||s.message;const l=this.multiple?k(o,this.mergedFileList):[o];this.onInternalChange(o,l,s)}}handleUpdateFileList(t){const e=Date.now();(t||[]).forEach(((t,i)=>{if(!t.uid&&!Object.isFrozen(t)){t.uid=`__AUTO__${e}_${i}__`}}));if(u(this.maxLength)){if(t.length>this.maxLength){this.isExceededMax=true;this.mergedFileList=t.slice(0,this.maxLength)}else{this.isExceededMax=false;this.mergedFileList=[...t]}}else{this.mergedFileList=[...t]}}handleExceededMaxChange(t){this.exceededMaxChange.emit(t)}handleUpdate(){this.children.forEach((t=>{t.disabled=this.disabled}))}async handleRemove(t){let e;await Promise.resolve(typeof this.beforeRemove==="function"?this.beforeRemove(new CustomEvent("beforeRemove",{detail:{file:t}})):this.beforeRemove).then((i=>{const s=g(t,this.mergedFileList);if(s){e={...t,status:"removed"};this.mergedFileList?.forEach((t=>{const i=e.uid!==undefined?"uid":"name";if(t[i]===e[i]&&!Object.isFrozen(t)){t.status="removed"}}));this.uploadEl.abort(e);this.onInternalChange(e,s)}}));this.isExceededMax=false}componentWillLoad(){this.children?.forEach((t=>{t.disabled=this.disabled}))}componentDidLoad(){const t=Date.now();(this.fileList||[]).forEach(((e,i)=>{if(!e.uid&&!Object.isFrozen(e)){e.uid=`__AUTO__${t}_${i}__`}}));this.mergedFileList=[...this.defaultFileList,...this.fileList]}render(){const t=c(f.exceededMaxLimit,{num_max_files:this.maxLength||""});return i(s,{key:"e03cdd41af699f6327152c4fb3f046df9f9473fb",dir:d(),"ks-upload":true},i("span",{key:"4347421f746aa461d008e05458d076e3e5894a38",dir:d(),class:l(j,{[`${j}--active`]:this.mergedFileList.some((t=>t.status==="uploading"))})},i("ks-rc-upload",{key:"7b2388f89d51e080a4cfbb79470f708f45c28bae",data:this.data,multiple:this.multiple,accept:this.accept,headers:this.headers,action:this.action,beforeUpload:this.beforeUpload,onsuccess:this.onSuccess,onfail:this.onFail,onpro:this.onProgress,name:this.name,disabled:this.disabled,ref:t=>this.uploadEl=t,customRequest:this.customRequest,maxLength:this.maxLength,fileListLength:this.mergedFileList.length},i("slot",{key:"d631dcc1948487ad9fb85109dde8f06688fb65c6"}),this.description&&i("ks-text",{key:"f2f4df4e5d93b03985632ccbff4e30432d9406a7",variant:"labelSm"},i("span",{key:"56682928ef9658f1fce550535d6e10633143bc5f",class:{disabled:this.disabled}},this.description))),this.showMessage&&(this.errorMessage||this.message||this.isExceededMax)&&i("div",{key:"e1046e2cff5b90933c5b56bc1be0d47657fbb91a",class:l(`${j}__message`,{[`${j}__message--error`]:this.isError||this.isExceededMax})},this.isExceededMax?i("ks-status-message",{variant:"error",richTextString:t}):this.isError?i("ks-status-message",{variant:"error",richTextString:this.errorMessage||this.message}):this.errorMessage||this.message),this.showUploadList&&i("ks-upload-list",{key:"51aad1b3b7783bdf5812f703fab2b791f0240ede",size:this.size,class:`${j}__file-list`,items:this.mergedFileList,onremove:t=>this.handleRemove(t),disabled:this.disabled})))}get el(){return a(this)}static get watchers(){return{fileList:["handleUpdateFileList"],isExceededMax:["handleExceededMaxChange"],disabled:["handleUpdate"]}}};z([r({slotname:"_default"})],$.prototype,"children",void 0);$.style=S;const M='@charset "UTF-8";ul,li{list-style:none;margin:0;padding:0}button{border:none;margin:0;padding:0;width:auto;overflow:visible;background:transparent;color:inherit;font:inherit;line-height:normal;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none}button::-moz-focus-inner{border:0;padding:0}.ks-text-bodyMd{font-size:var(--ks-text-bodyMd-fontSize);line-height:var(--ks-text-bodyMd-lineHeight);font-weight:var(--ks-text-bodyMd-fontWeight);letter-spacing:var(--ks-text-bodyMd-letterSpacing);font-family:var(--ks-text-bodyMd-fontFamily)}@keyframes breathing-opacity{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}.ks-skeleton,.animate-pulse{background-color:var(--ks-color-neutral-surface3);border-radius:var(--ks-border-radius-sm);animation-name:breathing-opacity;animation-duration:2s;animation-timing-function:cubic-bezier(0.455, 0, 0.55, 1);animation-fill-mode:forwards;animation-iteration-count:infinite}.ks-card-section{margin-bottom:var(--ks-spacing-400);font-size:var(--ks-text-titleMd-fontSize);line-height:var(--ks-text-titleMd-lineHeight);font-weight:var(--ks-text-titleMd-fontWeight);letter-spacing:var(--ks-text-titleMd-letterSpacing);font-family:var(--ks-text-titleMd-fontFamily)}*,:host{box-sizing:border-box}.upload-list .upload-list__item--sm{min-width:400px}.upload-list .upload-list__item--sm .upload-list__item-inner{gap:var(--ks-spacing-200)}.upload-list .upload-list__item--sm .upload-list__item-name{font-size:var(--ks-text-labelSm-fontSize)}.upload-list .upload-list__item--sm .upload-list__item-inner{flex-direction:row;align-items:center;justify-content:flex-start}.upload-list .upload-list__item--sm .upload-list__item-inner .upload-list__item-name{width:auto;font-size:var(--ks-text-labelSm-fontSize);line-height:var(--ks-text-labelSm-lineHeight);font-weight:var(--ks-text-labelSm-fontWeight);letter-spacing:var(--ks-text-labelSm-letterSpacing);font-family:var(--ks-text-labelSm-fontFamily)}.upload-list .upload-list__item--sm .upload-list__item-inner [ks-progress]{min-width:200px;flex-grow:1}.upload-list .upload-list__item--md{min-width:400px;height:50px}.upload-list .upload-list__item--md .upload-list__item-name{font-size:var(--ks-text-labelMd-fontSize)}.upload-list .upload-list__item--md .upload-list__item-thumb{width:32px;height:32px}.upload-list .upload-list__item--md .upload-list__item-thumb [ks-icon]{font-size:16px}.upload-list .upload-list__item--md .upload-list__item-thumb>img{width:32px;height:32px;background-size:contain;background-color:var(--ks-color-neutral-surface)}.upload-list .upload-list__item{display:flex;align-items:center;background-color:var(--ks-color-neutral-surface1);border-radius:var(--ks-border-radius-md);padding:var(--ks-spacing-200);box-sizing:border-box;height:40px;margin-top:var(--ks-spacing-200)}.upload-list .upload-list__item.upload-list__item--error{border:1px solid var(--ks-color-error-fill);padding:var(--ks-spacing-200) calc(var(--ks-spacing-200) - 1px)}.upload-list .upload-list__item-message{color:var(--ks-color-error-onSurface);font-size:var(--ks-text-labelSm-fontSize);line-height:var(--ks-text-labelSm-lineHeight);margin-top:var(--ks-spacing-100)}.upload-list .upload-list__item-thumb{display:flex;align-items:center;justify-content:center;border-radius:var(--ks-border-radius-innerMd);color:var(--ks-color-primary-fill);background-color:var(--ks-color-primary-surface2);flex-grow:0;flex-shrink:0}.upload-list .upload-list__item-inner{flex:1;overflow:hidden;text-overflow:ellipsis;word-wrap:normal;padding:0 var(--ks-spacing-200);display:flex;flex-direction:column;justify-content:center;gap:var(--ks-spacing-100)}.upload-list .upload-list__item-name{color:var(--ks-color-neutral-highOnSurface);text-decoration:none;width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;height:20px;font-size:var(--ks-text-bodySm-fontSize);line-height:var(--ks-text-bodySm-lineHeight);font-weight:var(--ks-text-bodySm-fontWeight);letter-spacing:var(--ks-text-bodySm-letterSpacing);font-family:var(--ks-text-bodySm-fontFamily)}.upload-list .upload-list__item-success{color:var(--ks-color-success-fillLow);margin-right:var(--ks-spacing-200)}.upload-list .upload-list__item-error{color:var(--ks-color-error-fillLow);margin-right:var(--ks-spacing-200)}.upload-list .upload-list__item-close{width:20px;flex-grow:0;flex-shrink:0;display:flex;align-items:center;justify-content:center;color:var(--ks-color-neutral-onSurface)}.upload-list .upload-list__item-close:hover{color:var(--ks-color-neutral-onSurface)}.upload-list .upload-list__item-close:active{color:var(--ks-color-neutral-onSurface)}.upload-list .upload-list__item-delete{cursor:pointer}';const L="upload-list";const C=t=>{if(t?.startsWith("image")){return i("ks-icon-picture",{slot:"icon"})}else if(t?.startsWith("audio")){return i("ks-icon-music",{slot:"icon"})}else if(t?.startsWith("video")){return i("ks-icon-video-clip",{slot:"icon"})}else{return i("ks-icon-folder",{slot:"icon"})}};const F=class{constructor(e){t(this,e);this["ks-name"]="ks-upload-list";this.disabled=false;this.items=[];this.size="md";this.preview={}}updatePreviewData(){this.items.forEach((async t=>{if(t.type?.startsWith("image")){this.preview[t.uid]=t.url??await h(t.originFileObj)}}))}componentWillLoad(){this.updatePreviewData()}handleUpdate(){this.updatePreviewData()}render(){return i(s,{key:"61ea1aa65a355c61bfa53ac601a19e30e823eebb",dir:d(),"ks-upload-list":true},i("div",{key:"5c0ebfe4b57f5e484d820bf55e882473f0ed3e3c",dir:d(),class:L},this.items.map((t=>i(o,null,i("div",{class:l(`${L}__item`,`${L}__item--${this.size}`,`${L}__item--${t.status}`)},i("div",{class:`${L}__item-thumb`},t.status==="uploading"?i("ks-thumbnail",{size:this.size==="md"?"sm":"xs"},C(t?.type)):t.type?.startsWith("image")?i("ks-thumbnail",{size:this.size==="md"?"sm":"xs",image:this.preview[t.uid]}):i("ks-thumbnail",{size:this.size==="md"?"sm":"xs"},C(t?.type))),i("div",{class:`${L}__item-inner`},t.url?i("a",{href:t.url,target:"_blank",class:`${L}__item-name`},t.name):i("span",{class:`${L}__item-name`},t.name),t.status==="uploading"&&i("ks-progress",{size:"sm",percent:t.percent,showLabel:false})),!this.disabled&&t.status==="done"&&i("div",{class:`${L}__item-success`},i("ks-status-icon",{variant:"success",size:this.size})),!this.disabled&&t.status==="error"&&i("div",{class:`${L}__item-error`},i("ks-status-icon",{variant:"error",size:this.size})),i("div",{class:`${L}__item-close`},!this.disabled&&i("ks-button",{size:"sm",variant:"text",shape:"square",onClick:()=>this.onremove?.(t),"data-testid":"upload-list-upload-list-xjpiXE"},i("ks-icon-close",{size:14,class:`${L}__item-delete`})))),t.status==="error"&&t.response&&i("div",{class:`${L}__item-message`},i("ks-status-message",{variant:"error"},t.response)))))))}static get watchers(){return{items:["handleUpdate"]}}};F.style=M;export{w as ks_rc_upload,$ as ks_upload,F as ks_upload_list};