import{i as t,l as s}from"./p-BVbYP5UG.js";import{a as o}from"./p-B9Bv72kO.js";import{B as e}from"./p-BpTTFEEs.js";import{i as a}from"./p-D7jkzT0S.js";class i{constructor(){this.idCounter=0;this.container=e;this.queue=new Map;this.default=this.open}handleModalClose(t){const s=this.queue.get(t);if(!s)return;this.queue.delete(t);this.onModalRemoved(t,s);s.resolve()}open(t){const s=`modal-${Date.now()}-${++this.idCounter}`;const o=this.normalizeConfig(t);const e=new Promise((t=>{this.queue.set(s,{id:s,config:o,resolve:t});this.onModalAdded(s,o)}));const a=()=>{this.handleModalClose(s)};return Object.assign(a,{then:e.then.bind(e),catch:e.catch.bind(e)})}closeAll(){this.queue.forEach((t=>t.resolve()));this.queue.clear();this.onAllModalsClosed()}}class n extends i{configureModalElement(s,e){const{btm:i,btmConfig:n,content:l,...d}=e;Object.entries(d).forEach((([t,e])=>o(s,t,e)));if(a(l)){s.appendChild(document.createTextNode(l))}s.setAttribute("data-btm",i);if(n){s.setAttribute("data-btm-config",t(n)?JSON.stringify(n):n.toString())}}setupModalLifecycle(t,s){s.cbAfterDidLoad=()=>{s.open()};s.addEventListener("ksClose",(()=>this.handleModalClose(t)))}normalizeConfig(s){const o={noHeader:false,noFooter:false};if(a(s)){return{...o,content:s}}return t(s)?{...o,...s}:o}onModalAdded(t,o){const e=document.createElement("ks-modal");e.setAttribute("data-modal-id",t);this.configureModalElement(e,o);try{this.container.appendChild(e);this.setupModalLifecycle(t,e)}catch(t){s.error("Failed to create modal:",t)}}onModalRemoved(t){try{const s=document.querySelector(`ks-modal[data-modal-id="${t}"]`);if(this.container.contains(s)){this.container.removeChild(s)}}catch(t){s.warn("Failed to remove modal element:",t)}}onAllModalsClosed(){try{const t=this.container.querySelectorAll("ks-modal[data-modal-id]");t.forEach((t=>{if(this.container.contains(t)){this.container.removeChild(t)}}))}catch(t){s.warn("Failed to clean up modal elements:",t)}}}const l=new n;export{i as B,l as m};