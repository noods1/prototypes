{"version":3,"names":["getWeekArray","locale","date","weeks","firstDayOfMonth","startOfMonth","lastDayOfMonth","endOfMonth","firstDayOfWeek","getFirstDayOfWeek","startOffset","getDay","currentDate","subDays","monthEndReached","currentWeek","i","push","addDays","length","hasCurrentMonth","some","day","getMonth","getFullYear","year","Intl","DateTimeFormat","format","month","replace","trim","getMonths","janurary","Date","Array","from","_","k","map","addMonths","getWeekdays","sunday","daysFromSunday","weekday","upperFirst","str","charAt","toLocaleUpperCase","slice"],"sources":["src/utils/calendar/date.ts"],"sourcesContent":["import { startOfMonth, endOfMonth, subDays, addDays, addMonths } from 'date-fns';\nimport { getFirstDayOfWeek } from '../i18n/date';\n\nexport const getWeekArray = (locale: string, date: Date) => {\n  const weeks: Date[][] = [];\n  const firstDayOfMonth = startOfMonth(date);\n  const lastDayOfMonth = endOfMonth(date);\n  const firstDayOfWeek = getFirstDayOfWeek(locale); // 获取周起始配置\n\n  // 调整起始日期计算逻辑\n  const startOffset = (firstDayOfMonth.getDay() - firstDayOfWeek + 7) % 7;\n  let currentDate = subDays(firstDayOfMonth, startOffset);\n\n  let monthEndReached = false;\n\n  let currentWeek: Date[] = [];\n  for (let i = 0; i < 42; i++) {\n    // 日期有效性检查\n    if (currentDate > lastDayOfMonth) {\n      monthEndReached = true;\n    }\n\n    currentWeek.push(currentDate);\n    currentDate = addDays(currentDate, 1);\n\n    // 周分割逻辑\n    if (currentWeek.length === 7 || i === 41) {\n      // 增强周有效性检查\n      const hasCurrentMonth = currentWeek.some(\n        (day) => day.getMonth() === date.getMonth() && day.getFullYear() === date.getFullYear(),\n      );\n\n      if (hasCurrentMonth) {\n        weeks.push(currentWeek);\n      }\n      currentWeek = [];\n\n      // 终止条件优化\n      if (monthEndReached && currentDate > addDays(lastDayOfMonth, 1)) {\n        break;\n      }\n    }\n  }\n\n  return weeks;\n};\n\nexport const getMonth = (date: Date, locale: string) => {\n  const year = new Intl.DateTimeFormat(locale, { year: 'numeric' }).format(date);\n  return new Intl.DateTimeFormat(locale, { month: 'short', year: 'numeric' }).format(date).replace(year, '').trim();\n};\n\nexport const getMonths = (locale = 'en-US') => {\n  const janurary = new Date(1970, 0);\n  return Array.from({ length: 12 }, (_, k) => k).map((i) => getMonth(addMonths(janurary, i), locale));\n};\n\nexport const getWeekdays = (locale = 'en-US', format: 'narrow' | 'short' = 'short') => {\n  const sunday = new Date(1970, 0, 4);\n  const daysFromSunday = getFirstDayOfWeek(locale);\n  return Array.from({ length: 7 }, (_, k) => k).map((i) =>\n    new Intl.DateTimeFormat(locale, { weekday: format }).format(addDays(sunday, daysFromSunday + i)),\n  );\n};\n\nexport const upperFirst = (str: string, locale: string) => str.charAt(0).toLocaleUpperCase(locale) + str.slice(1);\n"],"mappings":"8EAGaA,EAAe,CAACC,EAAgBC,KAC3C,MAAMC,EAAkB,GACxB,MAAMC,EAAkBC,eAAaH,GACrC,MAAMI,EAAiBC,aAAWL,GAClC,MAAMM,EAAiBC,EAAkBR,GAGzC,MAAMS,GAAeN,EAAgBO,SAAWH,EAAiB,GAAK,EACtE,IAAII,EAAcC,UAAQT,EAAiBM,GAE3C,IAAII,EAAkB,MAEtB,IAAIC,EAAsB,GAC1B,IAAK,IAAIC,EAAI,EAAGA,EAAI,GAAIA,IAAK,CAE3B,GAAIJ,EAAcN,EAAgB,CAChCQ,EAAkB,I,CAGpBC,EAAYE,KAAKL,GACjBA,EAAcM,UAAQN,EAAa,GAGnC,GAAIG,EAAYI,SAAW,GAAKH,IAAM,GAAI,CAExC,MAAMI,EAAkBL,EAAYM,MACjCC,GAAQA,EAAIC,aAAerB,EAAKqB,YAAcD,EAAIE,gBAAkBtB,EAAKsB,gBAG5E,GAAIJ,EAAiB,CACnBjB,EAAMc,KAAKF,E,CAEbA,EAAc,GAGd,GAAID,GAAmBF,EAAcM,UAAQZ,EAAgB,GAAI,CAC/D,K,GAKN,OAAOH,CAAK,E,MAGDoB,EAAW,CAACrB,EAAYD,KACnC,MAAMwB,EAAO,IAAIC,KAAKC,eAAe1B,EAAQ,CAAEwB,KAAM,YAAaG,OAAO1B,GACzE,OAAO,IAAIwB,KAAKC,eAAe1B,EAAQ,CAAE4B,MAAO,QAASJ,KAAM,YAAaG,OAAO1B,GAAM4B,QAAQL,EAAM,IAAIM,MAAM,E,MAGtGC,EAAY,CAAC/B,EAAS,WACjC,MAAMgC,EAAW,IAAIC,KAAK,KAAM,GAChC,OAAOC,MAAMC,KAAK,CAAEjB,OAAQ,KAAM,CAACkB,EAAGC,IAAMA,IAAGC,KAAKvB,GAAMO,EAASiB,YAAUP,EAAUjB,GAAIf,IAAQ,EAG9F,MAAMwC,EAAc,CAACxC,EAAS,QAAS2B,EAA6B,WACzE,MAAMc,EAAS,IAAIR,KAAK,KAAM,EAAG,GACjC,MAAMS,EAAiBlC,EAAkBR,GACzC,OAAOkC,MAAMC,KAAK,CAAEjB,OAAQ,IAAK,CAACkB,EAAGC,IAAMA,IAAGC,KAAKvB,GACjD,IAAIU,KAAKC,eAAe1B,EAAQ,CAAE2C,QAAShB,IAAUA,OAAOV,UAAQwB,EAAQC,EAAiB3B,KAC9F,EAGI,MAAM6B,EAAa,CAACC,EAAa7C,IAAmB6C,EAAIC,OAAO,GAAGC,kBAAkB/C,GAAU6C,EAAIG,MAAM,U","ignoreList":[]}