{"version":3,"names":["BaseModal","constructor","this","idCounter","container","BODYEL","queue","Map","default","open","handleModalClose","id","item","get","delete","onModalRemoved","resolve","config","Date","now","normalizedConfig","normalizeConfig","promise","Promise","set","onModalAdded","destroyFn","Object","assign","then","bind","catch","closeAll","forEach","clear","onAllModalsClosed","Modal","configureModalElement","element","btm","btmConfig","content","props","entries","key","value","assignment","isString","appendChild","document","createTextNode","setAttribute","isObject","JSON","stringify","toString","setupModalLifecycle","cbAfterDidLoad","addEventListener","defaultConfig","noHeader","noFooter","modalEl","createElement","error","logger","querySelector","contains","removeChild","warn","remainingModals","querySelectorAll","modal"],"sources":["src/utils/modal.ts","src/components/ks-modal/modal.ts"],"sourcesContent":["import { BODYEL } from '@src/utils/constants';\nimport type { Components } from '../components';\n\nexport interface BaseModalConfig<TContent>\n  extends Partial<Omit<Components.KsModal, 'cbAfterDidLoad' | 'open' | 'close' | 'content'>> {\n  btm?: string;\n  btmConfig?: string | Record<string, unknown>;\n  content?: TContent;\n}\n\nexport interface ModalItem<TConfig> {\n  id: string;\n  config: TConfig;\n  resolve: () => void;\n}\n\nexport interface ModalInstance {\n  (): void;\n  then: <T = void>(\n    onfulfilled?: (value: undefined) => T | PromiseLike<T>,\n    onrejected?: (reason: unknown) => T | PromiseLike<T>,\n  ) => Promise<T>;\n  catch: <T = void>(onrejected?: (reason: unknown) => T | PromiseLike<T>) => Promise<T>;\n}\n\nexport abstract class BaseModal<\n  TContent = string,\n  TConfig extends BaseModalConfig<TContent> = BaseModalConfig<TContent>,\n> {\n  private idCounter = 0;\n\n  protected container = BODYEL;\n  protected queue = new Map<string, ModalItem<TConfig>>();\n\n  /**\n   * Normalize input configuration - to be overridden by subclasses for different content types.\n   */\n  protected abstract normalizeConfig(config: TContent | TConfig): TConfig;\n  /**\n   * Called when a modal is added - to be implemented by subclasses.\n   */\n  protected abstract onModalAdded(id: string, config: TConfig): void;\n  /**\n   * Called when a modal is removed - to be implemented by subclasses.\n   */\n  protected abstract onModalRemoved(id: string, item: ModalItem<TConfig>): void;\n  /**\n   * Called when all modals are closed - to be implemented by subclasses.\n   */\n  protected abstract onAllModalsClosed(): void;\n  /**\n   * Handle modal close with common cleanup logic.\n   */\n  protected handleModalClose(id: string): void {\n    const item = this.queue.get(id);\n    if (!item) return;\n\n    this.queue.delete(id);\n    this.onModalRemoved(id, item);\n    item.resolve();\n  }\n\n  /**\n   * Open a modal with the given configuration.\n   */\n  public open(config: TContent | TConfig): ModalInstance {\n    const id = `modal-${Date.now()}-${++this.idCounter}`;\n    const normalizedConfig = this.normalizeConfig(config);\n\n    const promise = new Promise<void>((resolve) => {\n      this.queue.set(id, { id, config: normalizedConfig, resolve });\n      this.onModalAdded(id, normalizedConfig);\n    });\n\n    const destroyFn = () => {\n      this.handleModalClose(id);\n    };\n\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    return Object.assign(destroyFn, {\n      then: promise.then.bind(promise),\n      catch: promise.catch.bind(promise),\n    });\n  }\n  /**\n   * @alias open\n   */\n  public default = this.open;\n  /**\n   * Close all active modals.\n   */\n  public closeAll(): void {\n    this.queue.forEach((item) => item.resolve());\n    this.queue.clear();\n\n    this.onAllModalsClosed();\n  }\n}\n","import { isString, isObject } from 'lodash-es';\nimport { logger } from '@src/utils/logger';\nimport { assignment } from '@src/utils/utils';\nimport { BaseModal, type BaseModalConfig } from '@src/utils/modal';\n\nexport type ModalConfig = BaseModalConfig<string>;\n\n/**\n * DOM-based Modal implementation. Extends `BaseModal` with native DOM rendering capabilities.\n */\nclass Modal extends BaseModal<string, ModalConfig> {\n  private configureModalElement(element: HTMLKsModalElement, config: ModalConfig) {\n    // Basic property assignment\n    const { btm, btmConfig, content, ...props } = config;\n    Object.entries(props).forEach(([key, value]) => assignment(element, key, value));\n\n    // Content is a string, append it as a text node\n    if (isString(content)) {\n      element.appendChild(document.createTextNode(content));\n    }\n\n    // BTM tracking attributes\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    element.setAttribute('data-btm', btm);\n    if (btmConfig) {\n      element.setAttribute('data-btm-config', isObject(btmConfig) ? JSON.stringify(btmConfig) : btmConfig.toString());\n    }\n  }\n\n  private setupModalLifecycle(id: string, element: HTMLKsModalElement) {\n    // Auto-open modal after DOM is ready\n    element.cbAfterDidLoad = () => {\n      element.open();\n    };\n\n    // Handle modal close event and perform cleanup\n    element.addEventListener('ksClose', () => this.handleModalClose(id));\n  }\n\n  protected normalizeConfig(config: string | ModalConfig): ModalConfig {\n    const defaultConfig: ModalConfig = {\n      noHeader: false,\n      noFooter: false,\n    };\n\n    if (isString(config)) {\n      return { ...defaultConfig, content: config };\n    }\n    return isObject(config) ? { ...defaultConfig, ...config } : defaultConfig;\n  }\n\n  protected onModalAdded(id: string, config: ModalConfig): void {\n    const modalEl: HTMLKsModalElement = document.createElement('ks-modal');\n    modalEl.setAttribute('data-modal-id', id);\n    this.configureModalElement(modalEl, config);\n\n    try {\n      this.container.appendChild(modalEl);\n      this.setupModalLifecycle(id, modalEl);\n    } catch (error) {\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      logger.error('Failed to create modal:', error);\n    }\n  }\n\n  protected onModalRemoved(id: string): void {\n    try {\n      const element: HTMLKsModalElement | null = document.querySelector(`ks-modal[data-modal-id=\"${id}\"]`);\n      if (this.container.contains(element)) {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        this.container.removeChild(element);\n      }\n    } catch (error) {\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      logger.warn('Failed to remove modal element:', error);\n    }\n  }\n\n  protected onAllModalsClosed(): void {\n    try {\n      const remainingModals = this.container.querySelectorAll('ks-modal[data-modal-id]');\n      remainingModals.forEach((modal) => {\n        if (this.container.contains(modal)) {\n          this.container.removeChild(modal);\n        }\n      });\n    } catch (error) {\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      logger.warn('Failed to clean up modal elements:', error);\n    }\n  }\n}\n\n/**\n * Global modal popup manager for native DOM applications.\n * Supports preset variants, custom configurations, and promise-based handling.\n *\n * @example\n * ```typescript\n * // Basic usage\n * modal.open('Operation completed!');\n * modal.default('Something went wrong');\n *\n * // Custom configuration\n * modal.open({\n *   content: 'Custom message',\n *   noHeader: true,\n *   noFooter: true\n * });\n *\n * // Promise handling\n * const instance = modal.open('Please wait...');\n * instance.then(() => console.log('Closed'));\n * instance(); // Close manually\n * ```\n */\nexport const modal = new Modal();\n"],"mappings":"6JAyBsBA,EAAtB,WAAAC,GAIUC,KAASC,UAAG,EAEVD,KAASE,UAAGC,EACZH,KAAAI,MAAQ,IAAIC,IAuDfL,KAAAM,QAAUN,KAAKO,I,CAlCZ,gBAAAC,CAAiBC,GACzB,MAAMC,EAAOV,KAAKI,MAAMO,IAAIF,GAC5B,IAAKC,EAAM,OAEXV,KAAKI,MAAMQ,OAAOH,GAClBT,KAAKa,eAAeJ,EAAIC,GACxBA,EAAKI,S,CAMA,IAAAP,CAAKQ,GACV,MAAMN,EAAK,SAASO,KAAKC,WAAWjB,KAAKC,YACzC,MAAMiB,EAAmBlB,KAAKmB,gBAAgBJ,GAE9C,MAAMK,EAAU,IAAIC,SAAeP,IACjCd,KAAKI,MAAMkB,IAAIb,EAAI,CAAEA,KAAIM,OAAQG,EAAkBJ,YACnDd,KAAKuB,aAAad,EAAIS,EAAiB,IAGzC,MAAMM,EAAY,KAChBxB,KAAKQ,iBAAiBC,EAAG,EAI3B,OAAOgB,OAAOC,OAAOF,EAAW,CAC9BG,KAAMP,EAAQO,KAAKC,KAAKR,GACxBS,MAAOT,EAAQS,MAAMD,KAAKR,I,CAUvB,QAAAU,GACL9B,KAAKI,MAAM2B,SAASrB,GAASA,EAAKI,YAClCd,KAAKI,MAAM4B,QAEXhC,KAAKiC,mB,ECrFT,MAAMC,UAAcpC,EACV,qBAAAqC,CAAsBC,EAA6BrB,GAEzD,MAAMsB,IAAEA,EAAGC,UAAEA,EAASC,QAAEA,KAAYC,GAAUzB,EAC9CU,OAAOgB,QAAQD,GAAOT,SAAQ,EAAEW,EAAKC,KAAWC,EAAWR,EAASM,EAAKC,KAGzE,GAAIE,EAASN,GAAU,CACrBH,EAAQU,YAAYC,SAASC,eAAeT,G,CAK9CH,EAAQa,aAAa,WAAYZ,GACjC,GAAIC,EAAW,CACbF,EAAQa,aAAa,kBAAmBC,EAASZ,GAAaa,KAAKC,UAAUd,GAAaA,EAAUe,W,EAIhG,mBAAAC,CAAoB7C,EAAY2B,GAEtCA,EAAQmB,eAAiB,KACvBnB,EAAQ7B,MAAM,EAIhB6B,EAAQoB,iBAAiB,WAAW,IAAMxD,KAAKQ,iBAAiBC,I,CAGxD,eAAAU,CAAgBJ,GACxB,MAAM0C,EAA6B,CACjCC,SAAU,MACVC,SAAU,OAGZ,GAAId,EAAS9B,GAAS,CACpB,MAAO,IAAK0C,EAAelB,QAASxB,E,CAEtC,OAAOmC,EAASnC,GAAU,IAAK0C,KAAkB1C,GAAW0C,C,CAGpD,YAAAlC,CAAad,EAAYM,GACjC,MAAM6C,EAA8Bb,SAASc,cAAc,YAC3DD,EAAQX,aAAa,gBAAiBxC,GACtCT,KAAKmC,sBAAsByB,EAAS7C,GAEpC,IACEf,KAAKE,UAAU4C,YAAYc,GAC3B5D,KAAKsD,oBAAoB7C,EAAImD,E,CAC7B,MAAOE,GAEPC,EAAOD,MAAM,0BAA2BA,E,EAIlC,cAAAjD,CAAeJ,GACvB,IACE,MAAM2B,EAAqCW,SAASiB,cAAc,2BAA2BvD,OAC7F,GAAIT,KAAKE,UAAU+D,SAAS7B,GAAU,CAEpCpC,KAAKE,UAAUgE,YAAY9B,E,EAE7B,MAAO0B,GAEPC,EAAOI,KAAK,kCAAmCL,E,EAIzC,iBAAA7B,GACR,IACE,MAAMmC,EAAkBpE,KAAKE,UAAUmE,iBAAiB,2BACxDD,EAAgBrC,SAASuC,IACvB,GAAItE,KAAKE,UAAU+D,SAASK,GAAQ,CAClCtE,KAAKE,UAAUgE,YAAYI,E,KAG/B,MAAOR,GAEPC,EAAOI,KAAK,qCAAsCL,E,GA4B3C,MAAAQ,EAAQ,IAAIpC,S","ignoreList":[]}