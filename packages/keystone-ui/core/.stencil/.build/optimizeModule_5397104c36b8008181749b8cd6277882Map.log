{"version":3,"names":["FormContextValueReconcile","providerKey","contextKey","target","propertyKey","originalValueDescriptor","Object","getOwnPropertyDescriptor","originalContextValueDescriptor","isUpdatingInternalStateMap","WeakMap","valueMap","defineProperty","configurable","enumerable","set","value","get","this","call","uncontrollable","undefined"],"sources":["src/utils/form/FormContextValueReconcile.ts"],"sourcesContent":["import { ComponentInterface } from '@stencil/core';\n\nexport function FormContextValueReconcile({\n  providerKey = '_provider',\n  contextKey,\n}: {\n  providerKey?: string;\n  contextKey?: string;\n} = {}) {\n  return (target: ComponentInterface, propertyKey: string) => {\n    contextKey = contextKey || `${propertyKey}FromContext`;\n    const originalValueDescriptor = Object.getOwnPropertyDescriptor(target, propertyKey);\n    const originalContextValueDescriptor = Object.getOwnPropertyDescriptor(target, contextKey);\n    // Should use a map to distinguish different components\n    const isUpdatingInternalStateMap = new WeakMap<ComponentInterface, boolean>();\n\n    if (!originalValueDescriptor) {\n      return;\n    }\n\n    // original value from user\n    const valueMap = new WeakMap<HTMLElement, unknown>();\n    Object.defineProperty(target, propertyKey, {\n      configurable: true,\n      enumerable: true,\n      set(value) {\n        if (isUpdatingInternalStateMap.get(this)) {\n          originalValueDescriptor.set?.call(this, value);\n          return;\n        }\n        // 劫持 value 变化，记录原始值\n        valueMap.set(this, value);\n        originalValueDescriptor.set?.call(this, value);\n      },\n    });\n    Object.defineProperty(target, contextKey, {\n      configurable: true,\n      enumerable: true,\n      set(value) {\n        isUpdatingInternalStateMap.set(this, true);\n\n        // 劫持 contextValue 变化，并在 value 原始值是 undefined 时改变 value\n        originalContextValueDescriptor?.set?.call(this, value);\n        if (this[providerKey] === 'formItem') {\n          const uncontrollable = valueMap.get(this) === undefined;\n          if (uncontrollable) {\n            this[propertyKey] = value;\n          }\n        }\n\n        isUpdatingInternalStateMap.set(this, false);\n      },\n    });\n  };\n}\n"],"mappings":"AAEM,SAAUA,GAA0BC,YACxCA,EAAc,YAAWC,WACzBA,GAIE,IACF,MAAO,CAACC,EAA4BC,KAClCF,EAAaA,GAAc,GAAGE,eAC9B,MAAMC,EAA0BC,OAAOC,yBAAyBJ,EAAQC,GACxE,MAAMI,EAAiCF,OAAOC,yBAAyBJ,EAAQD,GAE/E,MAAMO,EAA6B,IAAIC,QAEvC,IAAKL,EAAyB,CAC5B,M,CAIF,MAAMM,EAAW,IAAID,QACrBJ,OAAOM,eAAeT,EAAQC,EAAa,CACzCS,aAAc,KACdC,WAAY,KACZ,GAAAC,CAAIC,GACF,GAAIP,EAA2BQ,IAAIC,MAAO,CACxCb,EAAwBU,KAAKI,KAAKD,KAAMF,GACxC,M,CAGFL,EAASI,IAAIG,KAAMF,GACnBX,EAAwBU,KAAKI,KAAKD,KAAMF,E,IAG5CV,OAAOM,eAAeT,EAAQD,EAAY,CACxCW,aAAc,KACdC,WAAY,KACZ,GAAAC,CAAIC,GACFP,EAA2BM,IAAIG,KAAM,MAGrCV,GAAgCO,KAAKI,KAAKD,KAAMF,GAChD,GAAIE,KAAKjB,KAAiB,WAAY,CACpC,MAAMmB,EAAiBT,EAASM,IAAIC,QAAUG,UAC9C,GAAID,EAAgB,CAClBF,KAAKd,GAAeY,C,EAIxBP,EAA2BM,IAAIG,KAAM,M,GAEvC,CAEN,Q","ignoreList":[]}