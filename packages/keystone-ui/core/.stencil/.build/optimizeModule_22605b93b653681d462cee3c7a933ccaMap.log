{"version":3,"names":["isIn","parentNodes","event","concat","map","el","shadowRoot","filter","i","il","length","targetInRootEventPath","getEventPath","target","path","composedPath","indexOf","window","getParents","node","memo","parentNode","rootEl","pathes","Outclick","constructor","warper","this","handlers","Map","document","addEventListener","clickHandler","bind","e","forEach","handler","els","isElement","root","fn","isOutClick","delete","on","set","off","outclick"],"sources":["src/utils/outclick.ts"],"sourcesContent":["import { isElement } from 'lodash-es';\n/**\n * 通过给document挂载mousedown事件，来触发关闭已经打开的popper、dialog等。\n */\nexport function isIn(parentNodes: (HTMLElement | ShadowRoot)[], event: MouseEvent) {\n  // 兼容shadow dom\n  parentNodes = (parentNodes || [])\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    .concat(parentNodes.map((el) => (el as HTMLElement)?.shadowRoot))\n    .filter((el) => !!el);\n  for (let i = 0, il = parentNodes.length; i < il; i += 1) {\n    /*\n     * 兼容 触发器在 shadow root中，e.target 指向web component本身 https://javascript.info/shadow-dom-events\n     * 因此弃用：// import { contains } from './utils'; if (contains(parentNodes[i], event.target)) return true;\n     */\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    if (targetInRootEventPath(event, parentNodes[i])) {\n      return true;\n    }\n  }\n  return false;\n}\n/**\n * 获取事件冒泡路径，兼容 IE11，Edge，Chrome，Firefox，Safari\n */\nexport function getEventPath(event: MouseEvent & { path?: Node[] }) {\n  const { target } = event;\n  const path = (event.composedPath && event.composedPath()) || event.path;\n  if (path) {\n    return path.indexOf(window) < 0 ? path.concat(window) : path;\n  }\n  if (target === window) {\n    return [window];\n  }\n  const getParents = (node: HTMLElement | EventTarget, memo: Node[]) => {\n    const { parentNode } = node as HTMLElement;\n    if (!parentNode) {\n      return memo;\n    } else {\n      return getParents(parentNode, memo.concat(parentNode));\n    }\n  };\n  // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n  return [target].concat(getParents(target, []), window);\n}\nexport function targetInRootEventPath(event: MouseEvent, rootEl: HTMLElement | ShadowRoot) {\n  const pathes = getEventPath(event);\n  return pathes.indexOf(rootEl) > -1;\n}\n\ntype OutclickListener = (opts?: { e?: MouseEvent; isOutClick?: boolean }) => void;\nclass Outclick {\n  handlers: Map<\n    OutclickListener,\n    {\n      root: HTMLElement;\n      fn: OutclickListener;\n      el: HTMLElement[] | HTMLElement;\n    }\n  > = new Map();\n  // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n  constructor(warper) {\n    // outclick 优先 click 执行\n    (warper ?? document).addEventListener('click', this.clickHandler.bind(this), true);\n  }\n  clickHandler(e: MouseEvent) {\n    this.handlers.forEach((handler) => {\n      let els = handler.el as HTMLElement[];\n      if (isElement(handler.el)) {\n        els = [handler.el as HTMLElement];\n      }\n      if (!targetInRootEventPath(e, handler.root) && !isIn(els, e)) {\n        handler.fn({ e, isOutClick: true });\n        this.handlers.delete(handler.fn);\n      }\n    });\n  }\n  /**\n   * @root 为原始触发click区域，默认作为out相对位置。如：popover组件的话，popover本身默认就是root。必传。没有root就没有out一说！！\n   * @fn outclick的回调，必传。也作为卸载的唯一标识。\n   * @el 排除触发outclick的元素。\n   */\n  on(root: HTMLElement, fn: OutclickListener, el?: HTMLElement[] | HTMLElement) {\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    this.handlers.set(fn, { root, fn, el });\n  }\n  off(fn: OutclickListener) {\n    this.handlers.delete(fn);\n  }\n}\n\nexport default new Outclick(document);\n"],"mappings":"oCAIgB,SAAAA,EAAKC,EAA2CC,GAE9DD,GAAeA,GAAe,IAE3BE,OAAOF,EAAYG,KAAKC,GAAQA,GAAoBC,cACpDC,QAAQF,KAASA,IACpB,IAAK,IAAIG,EAAI,EAAGC,EAAKR,EAAYS,OAAQF,EAAIC,EAAID,GAAK,EAAG,CAMvD,GAAIG,EAAsBT,EAAOD,EAAYO,IAAK,CAChD,OAAO,I,EAGX,OAAO,KACT,CAIM,SAAUI,EAAaV,GAC3B,MAAMW,OAAEA,GAAWX,EACnB,MAAMY,EAAQZ,EAAMa,cAAgBb,EAAMa,gBAAmBb,EAAMY,KACnE,GAAIA,EAAM,CACR,OAAOA,EAAKE,QAAQC,QAAU,EAAIH,EAAKX,OAAOc,QAAUH,C,CAE1D,GAAID,IAAWI,OAAQ,CACrB,MAAO,CAACA,O,CAEV,MAAMC,EAAa,CAACC,EAAiCC,KACnD,MAAMC,WAAEA,GAAeF,EACvB,IAAKE,EAAY,CACf,OAAOD,C,KACF,CACL,OAAOF,EAAWG,EAAYD,EAAKjB,OAAOkB,G,GAI9C,MAAO,CAACR,GAAQV,OAAOe,EAAWL,EAAQ,IAAKI,OACjD,CACgB,SAAAN,EAAsBT,EAAmBoB,GACvD,MAAMC,EAASX,EAAaV,GAC5B,OAAOqB,EAAOP,QAAQM,IAAU,CAClC,CAGA,MAAME,EAUJ,WAAAC,CAAYC,GATZC,KAAAC,SAOI,IAAIC,KAILH,GAAUI,UAAUC,iBAAiB,QAASJ,KAAKK,aAAaC,KAAKN,MAAO,K,CAE/E,YAAAK,CAAaE,GACXP,KAAKC,SAASO,SAASC,IACrB,IAAIC,EAAMD,EAAQ/B,GAClB,GAAIiC,EAAUF,EAAQ/B,IAAK,CACzBgC,EAAM,CAACD,EAAQ/B,G,CAEjB,IAAKM,EAAsBuB,EAAGE,EAAQG,QAAUvC,EAAKqC,EAAKH,GAAI,CAC5DE,EAAQI,GAAG,CAAEN,IAAGO,WAAY,OAC5Bd,KAAKC,SAASc,OAAON,EAAQI,G,KASnC,EAAAG,CAAGJ,EAAmBC,EAAsBnC,GAE1CsB,KAAKC,SAASgB,IAAIJ,EAAI,CAAED,OAAMC,KAAInC,M,CAEpC,GAAAwC,CAAIL,GACFb,KAAKC,SAASc,OAAOF,E,EAIzB,IAAAM,EAAe,IAAItB,EAASM,iB","ignoreList":[]}