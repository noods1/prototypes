import{r as e,c as t,t as i,h as s,H as n,a as r}from"./p-BVbYP5UG.js";import{d as o}from"./p-B9Bv72kO.js";import"@oddbird/popover-polyfill";import"./p-BpTTFEEs.js";const a='@charset "UTF-8";ul,li{list-style:none;margin:0;padding:0}button{border:none;margin:0;padding:0;width:auto;overflow:visible;background:transparent;color:inherit;font:inherit;line-height:normal;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none}button::-moz-focus-inner{border:0;padding:0}.ks-text-bodyMd{font-size:var(--ks-text-bodyMd-fontSize);line-height:var(--ks-text-bodyMd-lineHeight);font-weight:var(--ks-text-bodyMd-fontWeight);letter-spacing:var(--ks-text-bodyMd-letterSpacing);font-family:var(--ks-text-bodyMd-fontFamily)}@keyframes breathing-opacity{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}.ks-skeleton,.animate-pulse{background-color:var(--ks-color-neutral-surface3);border-radius:var(--ks-border-radius-sm);animation-name:breathing-opacity;animation-duration:2s;animation-timing-function:cubic-bezier(0.455, 0, 0.55, 1);animation-fill-mode:forwards;animation-iteration-count:infinite}.ks-card-section{margin-bottom:var(--ks-spacing-400);font-size:var(--ks-text-titleMd-fontSize);line-height:var(--ks-text-titleMd-lineHeight);font-weight:var(--ks-text-titleMd-fontWeight);letter-spacing:var(--ks-text-titleMd-letterSpacing);font-family:var(--ks-text-titleMd-fontFamily)}*,:host{box-sizing:border-box}:host{display:block}.tree-view{position:relative;display:flex;flex-direction:column;row-gap:var(--ks-spacing-100);overflow:auto}.tree-view__node{display:flex;align-items:center;transition-property:background-color;transition-duration:100ms;transition-timing-function:var(--ks-transition-easing-standardOut);border-radius:var(--ks-border-radius-md)}.tree-view__node:not(.tree-view__node--disabled):hover{background-color:var(--ks-color-neutral-surface2)}.tree-view__node:not(.tree-view__node--disabled):active{background-color:var(--ks-color-neutral-surface2Active)}.tree-view__node-active:not(.tree-view__node--disabled):hover{background-color:var(--ks-color-primary-surface2Hover)}.tree-view__node-active:not(.tree-view__node--disabled):active{background-color:var(--ks-color-primary-surface2Active)}.tree-view__node[dir=rtl] .tree-view__expand-icon{transform:rotate(90deg)}.tree-view__node[dir=rtl] .tree-view__node--expanded{transform:none}.tree-view__node-expanded:not(.tree-view__node--disabled){background-color:var(--ks-color-primary-surface2)}.tree-view__label{display:block;padding:var(--ks-spacing-200);padding-left:0;height:36px;flex:1;overflow:hidden;cursor:pointer}.tree-view--disabled .tree-view__label{cursor:not-allowed}.tree-view__label--disabled{color:var(--ks-color-primary-onSurfaceDisabled)}.tree-view__label--checked{color:var(--ks-color-primary-onSurface)}.tree-view__label--padded{padding-left:var(--ks-spacing-200)}.tree-view__expand-icon{padding:0 var(--ks-spacing-200);cursor:pointer;transition-property:transform;transition-duration:200ms;transition-timing-function:var(--ks-transition-easing-standardInOut);transform:rotate(-90deg)}.tree-view__node--disabled .tree-view__expand-icon{cursor:not-allowed;color:var(--ks-color-primary-onSurfaceDisabled)}.tree-view__tooltip::part(default){width:100%}.tree-view__node--expanded{transform:none}.tree-view__no-expand-icon{margin-left:var(--ks-spacing-500)}';const d="tree-view";const h=40;const l=5;const c=class{constructor(i){e(this,i);this.ksCheck=t(this,"ksCheck",1);this.ksCheckFull=t(this,"ksCheckFull",1);this.ksLoadMore=t(this,"ksLoadMore",1);this.ksToggleExpand=t(this,"ksToggleExpand",1);this["ks-name"]="ks-tree-view";this.selectedKeys=new Set;this.halfKeys=new Set;this.innerExpandedKeys=new Set;this.scrollTop=0;this.viewportHeight=0;this.visibleNodes=[];this.nodeMap=new Map;this.parentMap=new Map;this.flattenedNodes=[];this.startIndex=0;this.endIndex=0;this.totalHeight=0;this.lastRenderTime=0;this.height="100%";this.selectable=false;this.multiple=false;this.disabled=false;this.treeData=[];this.wrapWithSlot=(e,t)=>t;this.handleNodeClick=(e,t=false)=>{if(this.disabled||e.disabled){return}if(this.multiple){this.handleMultiSelect(e,t)}else{this.handleSingleSelect(e,t)}}}handleExpandedKeys(){this.innerExpandedKeys=new Set(this.expandedKeys??[])}handleInnerExpandedKeys(){const e=this.containerRef?.scrollTop||0;this.updateVisibleNodes();this.totalHeight=this.visibleNodes.length*h;requestAnimationFrame((()=>{if(this.containerRef){this.containerRef.scrollTop=e;this.updateVisibleRange()}}))}treeDataWatcher(){requestAnimationFrame((()=>{this.flattenedNodes=this.flattenNodes(this.treeData);this.updateVisibleNodes();this.totalHeight=this.visibleNodes.length*h;this.updateVisibleRange();let e=undefined;this.selectedKeys.clear();this.halfKeys=new Set;this.innerExpandedKeys.clear();if(this.expandedKeys!==undefined){this.innerExpandedKeys=new Set(this.expandedKeys)}else if(this.defaultExpandedKeys){this.innerExpandedKeys=new Set(this.defaultExpandedKeys)}if(this.checkedKeys){e=new Set(this.checkedKeys)}else if(this.defaultCheckedKeys){e=new Set(this.defaultCheckedKeys)}if(e!==undefined){e.forEach((e=>{if(this.selectedKeys.has(e))return;const t=this.nodeMap.get(e);if(t.disabled){if(!this.multiple){this.selectedKeys.clear()}this.selectedKeys.add(e)}else{this.handleNodeClick(t,true)}}))}}))}handleScroll(e){const t=performance.now();if(t-this.lastRenderTime<16){return}this.lastRenderTime=t;this.scrollTop=e.target.scrollTop;this.updateVisibleRange()}updateVisibleNodes(){this.visibleNodes=this.flattenedNodes.filter(this.isNodeVisible.bind(this));this.setDynamicRenderDeps?.(c.__internal_renderDynamicSlots(this,this.wrapWithSlot,{startIndex:this.startIndex,endIndex:this.endIndex,visibleNodes:this.visibleNodes}))}updateVisibleRange(){if(!this.containerRef){return}const e=Math.floor(this.scrollTop/h);const t=Math.ceil((this.scrollTop+this.viewportHeight)/h);this.startIndex=Math.max(0,e-l);this.endIndex=Math.min(this.visibleNodes.length-1,t+l);this.setDynamicRenderDeps?.(c.__internal_renderDynamicSlots(this,this.wrapWithSlot,{startIndex:this.startIndex,endIndex:this.endIndex,visibleNodes:this.visibleNodes}));i(this.el)}flattenNodes(e,t=0,i=null){return e.reduce(((e,s)=>{const n={...s,level:t,parent:i,isExpanded:false,isLeaf:!s.children?.length};this.nodeMap.set(s.key,n);if(i!==null){this.parentMap.set(s.key,this.nodeMap.get(i))}e.push(n);if(s.children?.length){e.push(...this.flattenNodes(s.children,t+1,s.key))}return e}),[])}toggleExpand(e){if(this.disabled||e.disabled){return}if(e.loading){this.ksLoadMore.emit(e.key);return}const t=!this.innerExpandedKeys.has(e.key);const i=new Set(t?[...this.innerExpandedKeys,e.key]:[...this.innerExpandedKeys].filter((t=>t!==e.key)));if(this.expandedKeys!==undefined){this.ksToggleExpand.emit({expanded:t,node:e,expandedKeys:Array.from(i)})}else this.innerExpandedKeys=i;const s=this.containerRef?.scrollTop||0;this.updateVisibleNodes();this.totalHeight=this.visibleNodes.length*h;requestAnimationFrame((()=>{if(this.containerRef){this.containerRef.scrollTop=s;this.updateVisibleRange()}}))}handleSingleSelect(e,t=false){this.selectedKeys=new Set([e.key]);if(t)return;this.ksCheck.emit({checked:true,node:e,checkedKeys:Array.from(this.selectedKeys),checkedNodes:Array.from(this.selectedKeys).map((e=>this.nodeMap.get(e))),halfCheckedKeys:Array.from(this.halfKeys)});this.ksCheckFull.emit([e.key])}handleMultiSelect(e,t=false){if(this.maxSelectCount&&this.selectedKeys.size>=this.maxSelectCount&&!this.selectedKeys.has(e.key)&&!this.halfKeys.has(e.key)){return}const i=new Set(this.selectedKeys);const s=!this.selectedKeys.has(e.key)||this.halfKeys.has(e.key);this.updateChildrenSelection(e,i,s);this.updateParentSelection(e,i);this.selectedKeys=i;if(t)return;const n=this.getEffectiveSelection();this.ksCheck.emit({checked:s,node:e,checkedKeys:Array.from(n),checkedNodes:Array.from(n).map((e=>this.nodeMap.get(e))),halfCheckedKeys:Array.from(this.halfKeys)});this.ksCheckFull.emit(Array.from(this.selectedKeys))}updateChildrenSelection(e,t,i){if(e.disabled){return}if(i){t.add(e.key);this.halfKeys.delete(e.key)}else{t.delete(e.key);this.halfKeys.delete(e.key)}const s=this.flattenedNodes.filter((t=>t.parent===e.key));s.forEach((e=>{this.updateChildrenSelection(e,t,i)}))}updateParentSelection(e,t){let i=this.parentMap.get(e.key);while(i){const e=this.flattenedNodes.filter((e=>e.parent===i.key&&!e.disabled));const s=e.filter((e=>t.has(e.key)));const n=e.filter((e=>this.halfKeys.has(e.key)));if(s.length===e.length){t.add(i.key);this.halfKeys.delete(i.key)}else if(s.length===0&&n.length===0){t.delete(i.key);this.halfKeys.delete(i.key)}else{t.delete(i.key);this.halfKeys.add(i.key)}i=this.parentMap.get(i.key)}}getEffectiveSelection(){const e=new Set;for(const t of this.selectedKeys){const i=this.nodeMap.get(t);if(!i){continue}e.add(t)}return e}componentWillLoad(){this.treeDataWatcher();this.resizeObserver=new ResizeObserver((e=>{for(const t of e){if(t.target===this.containerRef){this.viewportHeight=t.contentRect.height;this.updateVisibleRange()}}}))}componentDidLoad(){if(this.containerRef){this.resizeObserver.observe(this.containerRef);this.viewportHeight=this.containerRef.clientHeight;this.updateVisibleRange()}}disconnectedCallback(){this.resizeObserver.disconnect()}renderNode(e,t){const i=typeof e.selectable==="undefined"?this.selectable:e.selectable;const n=this.selectedKeys.has(e.key);const r=this.halfKeys.has(e.key);const a=this.disabled||e.disabled;const l=e.renderOptions?.popover;const{render:c,...f}=l||{};const p=s("div",{class:{[`${d}__node`]:true,[`${d}__node--selected`]:n,[`${d}__node--half`]:r,[`${d}__node--disabled`]:a,[`${d}__node--expanded`]:this.innerExpandedKeys.has(e.key),[`${d}__no-expand-icon`]:e.isLeaf}},!e.isLeaf&&s("ks-icon-filled-chevron-down",{size:12,class:{[`${d}__expand-icon`]:true,[`${d}__node--expanded`]:this.innerExpandedKeys.has(e.key)},onClick:()=>this.toggleExpand(e),"data-testid":"ks-tree-view-index-q9Hvh5"}),i&&this.multiple?s("ks-checkbox",{class:{[`${d}__label`]:true,[`${d}__label--disabled`]:a,[`${d}__label--padded`]:e.isLeaf},checked:n,indeterminate:r,disabled:a,onKsChange:()=>this.handleNodeClick(e),onClick:()=>this.handleNodeClick(e),"data-testid":"ks-tree-view-index-1UrNnE"},s("ks-text",{ellipsis:true,variant:"bodySm"},typeof e.label==="string"?e.label:s("slot",{name:`node-${t}`}))):s("ks-text",{ellipsis:true,variant:"bodySm",class:{[`${d}__label`]:true,[`${d}__label--checked`]:n,[`${d}__label--disabled`]:a,[`${d}__label--padded`]:e.isLeaf},onClick:()=>i?this.handleNodeClick(e):this.toggleExpand(e),"data-testid":"ks-tree-view-index-wDtwhQ"},typeof e.label==="string"?e.label:s("slot",{name:`node-${t}`})));return s("div",{key:e.key,style:{position:"absolute",top:`${(this.startIndex+t)*h}px`,left:"0",width:"100%",height:`${h}px`},"data-testid":`ks-tree-view-index-2e9R2R-${e.key}`},s("div",{key:e.key,style:{paddingLeft:`${e.level*24}px`},dir:o(),"data-testid":`ks-tree-view-index-1wwQoE-${e.key}`},l?s("ks-tooltip",{class:`${d}__tooltip`,trigger:"hover",...f,key:e.key,"data-testid":`ks-tree-view-index-rDqMXc-${e.key}`},c?s("div",{id:`popover-${t}`,slot:"content"},s("slot",{name:`popover-${t}`})):s("ks-text",{slot:"content",variant:"bodySm"},l.content||""),p):p))}isNodeVisible(e){if(!e.visible){return false}if(!e.parent){return true}let t=this.nodeMap.get(e.parent);while(t){if(!this.innerExpandedKeys.has(t.key)){return false}t=t.parent?this.nodeMap.get(t.parent):null}return true}static __internal_renderDynamicSlots(e,t,i={}){const s=(i.visibleNodes||[]).slice(i.startIndex,i.endIndex+1);const n=s.map(((e,i)=>typeof e.label==="function"&&t(`node-${i}`,e.label()))).filter(Boolean);const r=s.map(((e,i)=>typeof e.renderOptions?.popover?.render==="function"&&t(`popover-${i}`,e.renderOptions?.popover?.render()))).filter(Boolean);return[...n,...r]}render(){const e=this.visibleNodes.slice(this.startIndex,this.endIndex+1);return s(n,{key:"d0ec75b9bb734985eb63e23feac9c3dc2889e3d5",dir:o(),"ks-tree-view":true,role:"tree"},s("div",{key:"5db96fecf3fae54d13702c8ae370d4ab61b35397",ref:e=>{this.containerRef=e},class:d,style:{height:typeof this.height==="number"?`${this.height}px`:this.height},onScroll:this.handleScroll.bind(this),"data-testid":"ks-tree-view-index-6VTVNb"},s("div",{key:"2b1edf93a7527caf79bbb3946354a4da1257667e",style:{height:`${this.totalHeight}px`,position:"relative"}},e.map(((e,t)=>this.renderNode(e,t))))))}get el(){return r(this)}static get watchers(){return{expandedKeys:["handleExpandedKeys"],innerExpandedKeys:["handleInnerExpandedKeys"],treeData:["treeDataWatcher"],checkedKeys:["treeDataWatcher"]}}};c.style=a;export{c as ks_tree_view};