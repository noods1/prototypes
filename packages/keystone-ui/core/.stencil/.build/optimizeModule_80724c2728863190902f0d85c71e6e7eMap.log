{"version":3,"names":["decoratePropertySetter","targetPrototype","propertyName","setter","get","originalGetter","set","originalSetter","Object","getOwnPropertyDescriptor","defineProperty","configurable","enumerable","value","call","this","Uncontrollable","controlledPropName","uncontrolledPropName","updateEventName","internalStateName","registered","isUpdatingInternalStateMap","WeakMap","originalComponentWillLoad","componentWillLoad","__didComponentWillLoad","originalConnectedCallback","connectedCallback","isUncontrolled","undefined","oldValue","controlledValue","emit"],"sources":["src/utils/decorators/uncontrollable.ts"],"sourcesContent":["import { ComponentInterface } from '@stencil/core';\n\nfunction decoratePropertySetter(\n  targetPrototype: ComponentInterface,\n  propertyName: string,\n  setter: (value: unknown, originalSetter: (value: unknown) => void) => void,\n) {\n  const { get: originalGetter, set: originalSetter } =\n    Object.getOwnPropertyDescriptor(targetPrototype, propertyName) || {};\n  Object.defineProperty(targetPrototype, propertyName, {\n    configurable: true,\n    enumerable: true,\n    get: originalGetter,\n    set(value: unknown) {\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      setter.call(this, value, originalSetter);\n    },\n  });\n}\n\n/**\n * @description Decorator to make a property \"uncontrolled\" by a uncontrollable property combination.\n * e.g.\n * `@Prop() value?: string;`\n * `@Prop() defaultValue?: string;`\n * `@Event({ bubbles: false }) ksValueChange: EventEmitter<string>;`\n * `@Uncontrollable('value', 'defaultValue', 'ksValueChange') @State() mergedValue: string;`\n *\n * Then, get value from `mergedValue` and set value to `mergedValue` in the component will be handled correctly in both controlled and uncontrolled mode.\n *\n * If you want to use `@Watch()` to watch it, you should combine `@Uncontrollable()` with `@State()` to make it reactive.\n *\n * @param controlledPropName The prop name for controlled mode value. e.g. `'value'` for `@Prop() value`.\n * @param uncontrolledPropName The prop name of for uncontrolled mode default value. e.g. `'defaultValue'` for `@Prop() defaultValue`.\n * @param updateEventName The name of the event that is emitted when the property is updated. e.g. `'ksValueChange'` for `@Event() ksValueChange`.\n */\nexport function Uncontrollable(controlledPropName: string, uncontrolledPropName: string, updateEventName: string) {\n  return (targetPrototype: ComponentInterface, internalStateName: string) => {\n    let registered = false;\n\n    // Should use a map to distinguish different components\n    const isUpdatingInternalStateMap = new WeakMap<ComponentInterface, boolean>();\n\n    const originalComponentWillLoad = targetPrototype.componentWillLoad;\n    targetPrototype.componentWillLoad = function () {\n      originalComponentWillLoad?.call(this);\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      this.__didComponentWillLoad = true;\n    };\n\n    const originalConnectedCallback = targetPrototype.connectedCallback;\n    targetPrototype.connectedCallback = function () {\n      isUpdatingInternalStateMap.set(this, true);\n      const isUncontrolled = this[controlledPropName] === undefined;\n      this[internalStateName] = isUncontrolled ? this[uncontrolledPropName] : this[controlledPropName];\n      isUpdatingInternalStateMap.set(this, false);\n\n      if (registered) {\n        originalConnectedCallback?.call(this);\n        return;\n      }\n\n      decoratePropertySetter(targetPrototype, controlledPropName, function (value, originalSetter) {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        isUpdatingInternalStateMap.set(this, true);\n\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        const oldValue = this[controlledPropName];\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        originalSetter?.call(this, value);\n\n        if (value !== oldValue) {\n          const isUncontrolled = value === undefined;\n          if (isUncontrolled) {\n            // Reset to default value\n            // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n            this[internalStateName] = this[uncontrolledPropName];\n          } else {\n            // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n            this[internalStateName] = value;\n          }\n        }\n\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        isUpdatingInternalStateMap.set(this, false);\n      });\n\n      decoratePropertySetter(targetPrototype, uncontrolledPropName, function (value, originalSetter) {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        isUpdatingInternalStateMap.set(this, true);\n\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        originalSetter?.call(this, value);\n\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        const isUncontrolled = this[controlledPropName] === undefined;\n        // Only trigger in uncontrolled mode and the first render not yet happened\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        if (isUncontrolled && !this.__didComponentWillLoad) {\n          // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n          this[internalStateName] = value;\n        }\n\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        isUpdatingInternalStateMap.set(this, false);\n      });\n\n      decoratePropertySetter(targetPrototype, internalStateName, function (value, originalSetter) {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        if (isUpdatingInternalStateMap.get(this)) {\n          // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n          originalSetter?.call(this, value);\n          return;\n        }\n\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        const oldValue = this[internalStateName];\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        const controlledValue = this[controlledPropName];\n        if (value !== oldValue && value !== controlledValue) {\n          // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n          this[updateEventName].emit(value);\n        }\n\n        const isUncontrolled = controlledValue === undefined;\n        // Only update internal state in uncontrolled mode\n        if (isUncontrolled) {\n          // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n          originalSetter?.call(this, value);\n        }\n      });\n\n      registered = true;\n      originalConnectedCallback?.call(this);\n    };\n  };\n}\n"],"mappings":"AAEA,SAASA,EACPC,EACAC,EACAC,GAEA,MAAQC,IAAKC,EAAgBC,IAAKC,GAChCC,OAAOC,yBAAyBR,EAAiBC,IAAiB,GACpEM,OAAOE,eAAeT,EAAiBC,EAAc,CACnDS,aAAc,KACdC,WAAY,KACZR,IAAKC,EACL,GAAAC,CAAIO,GAEFV,EAAOW,KAAKC,KAAMF,EAAON,E,GAG/B,C,SAkBgBS,EAAeC,EAA4BC,EAA8BC,GACvF,MAAO,CAAClB,EAAqCmB,KAC3C,IAAIC,EAAa,MAGjB,MAAMC,EAA6B,IAAIC,QAEvC,MAAMC,EAA4BvB,EAAgBwB,kBAClDxB,EAAgBwB,kBAAoB,WAClCD,GAA2BV,KAAKC,MAEhCA,KAAKW,uBAAyB,IAChC,EAEA,MAAMC,EAA4B1B,EAAgB2B,kBAClD3B,EAAgB2B,kBAAoB,WAClCN,EAA2BhB,IAAIS,KAAM,MACrC,MAAMc,EAAiBd,KAAKE,KAAwBa,UACpDf,KAAKK,GAAqBS,EAAiBd,KAAKG,GAAwBH,KAAKE,GAC7EK,EAA2BhB,IAAIS,KAAM,OAErC,GAAIM,EAAY,CACdM,GAA2Bb,KAAKC,MAChC,M,CAGFf,EAAuBC,EAAiBgB,GAAoB,SAAUJ,EAAON,GAE3Ee,EAA2BhB,IAAIS,KAAM,MAGrC,MAAMgB,EAAWhB,KAAKE,GAEtBV,GAAgBO,KAAKC,KAAMF,GAE3B,GAAIA,IAAUkB,EAAU,CACtB,MAAMF,EAAiBhB,IAAUiB,UACjC,GAAID,EAAgB,CAGlBd,KAAKK,GAAqBL,KAAKG,E,KAC1B,CAELH,KAAKK,GAAqBP,C,EAK9BS,EAA2BhB,IAAIS,KAAM,MACvC,IAEAf,EAAuBC,EAAiBiB,GAAsB,SAAUL,EAAON,GAE7Ee,EAA2BhB,IAAIS,KAAM,MAGrCR,GAAgBO,KAAKC,KAAMF,GAG3B,MAAMgB,EAAiBd,KAAKE,KAAwBa,UAGpD,GAAID,IAAmBd,KAAKW,uBAAwB,CAElDX,KAAKK,GAAqBP,C,CAI5BS,EAA2BhB,IAAIS,KAAM,MACvC,IAEAf,EAAuBC,EAAiBmB,GAAmB,SAAUP,EAAON,GAE1E,GAAIe,EAA2BlB,IAAIW,MAAO,CAExCR,GAAgBO,KAAKC,KAAMF,GAC3B,M,CAIF,MAAMkB,EAAWhB,KAAKK,GAEtB,MAAMY,EAAkBjB,KAAKE,GAC7B,GAAIJ,IAAUkB,GAAYlB,IAAUmB,EAAiB,CAEnDjB,KAAKI,GAAiBc,KAAKpB,E,CAG7B,MAAMgB,EAAiBG,IAAoBF,UAE3C,GAAID,EAAgB,CAElBtB,GAAgBO,KAAKC,KAAMF,E,CAE/B,IAEAQ,EAAa,KACbM,GAA2Bb,KAAKC,KAClC,CAAC,CAEL,Q","ignoreList":[]}