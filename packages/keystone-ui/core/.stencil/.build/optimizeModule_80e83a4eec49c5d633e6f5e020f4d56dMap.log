{"version":3,"names":["LOCALE_SEPARATOR","fr","grouping","decimal","forEach","localeCode","groupingSeparator","groupingSeparatorRegexp","decimalSeparator","validCharSet","resetNumberLocalizationSetting","locale","newGroupingSeparator","newDecimalSeparator","Set","RegExp","store","get","onChange","sanitizeLocalizedNumber","localizedNumber","sanitized","hasEncounteredDecimalSeparator","char","has","parseLocalizedNumber","numberString","replace","Number","EN_US_GROUPING_REGEXP","formatToLocalizedNumber","number","precision","parts","toFixed","split","String","toLocaleString","join"],"sources":["src/utils/i18n/number.ts"],"sourcesContent":["import store from '@src/store';\nimport { Locale } from '@src/entities';\n\nconst LOCALE_SEPARATOR: Record<string, { grouping: string; decimal: string }> = {\n  fr: {\n    grouping: ' ',\n    decimal: ',',\n  },\n};\n['de', 'es', 'id', 'it', 'pt-BR'].forEach(\n  (localeCode) =>\n    (LOCALE_SEPARATOR[localeCode] = {\n      grouping: '.',\n      decimal: ',',\n    }),\n);\n\nlet groupingSeparator: string;\nlet groupingSeparatorRegexp: RegExp;\nlet decimalSeparator: string;\nlet validCharSet: Set<string>;\nfunction resetNumberLocalizationSetting(locale: Locale) {\n  // TODO prettier this type\n  const newGroupingSeparator = LOCALE_SEPARATOR[locale]?.grouping || ',';\n  const newDecimalSeparator = LOCALE_SEPARATOR[locale]?.decimal || '.';\n\n  if (newGroupingSeparator === groupingSeparator && newDecimalSeparator === decimalSeparator) {\n    return;\n  }\n\n  groupingSeparator = newGroupingSeparator;\n  decimalSeparator = newDecimalSeparator;\n\n  validCharSet = new Set([groupingSeparator, decimalSeparator, ...'0123456789']);\n  groupingSeparatorRegexp = new RegExp(`\\\\${groupingSeparator}`, 'g');\n}\n\nresetNumberLocalizationSetting(store.get('config').locale);\nstore.onChange('config', ({ locale }) => resetNumberLocalizationSetting(locale));\n\nexport function sanitizeLocalizedNumber(localizedNumber: string) {\n  let sanitized = '';\n  let hasEncounteredDecimalSeparator = false;\n\n  for (const char of localizedNumber) {\n    if (!validCharSet.has(char)) {\n      continue;\n    }\n\n    if (char === decimalSeparator) {\n      if (hasEncounteredDecimalSeparator) {\n        break;\n      }\n      hasEncounteredDecimalSeparator = true;\n    }\n    sanitized += char;\n  }\n\n  return sanitized;\n}\n\nexport function parseLocalizedNumber(localizedNumber: string): number | null {\n  const numberString = localizedNumber.replace(groupingSeparatorRegexp, '').replace(decimalSeparator, '.');\n  return numberString ? Number(numberString) : null;\n}\n\nconst EN_US_GROUPING_REGEXP = new RegExp(',', 'g');\nexport function formatToLocalizedNumber(number: number, precision?: number) {\n  let parts: string[];\n  if (typeof precision === 'number') {\n    parts = number.toFixed(precision).split('.');\n  } else {\n    parts = String(number).split('.');\n  }\n\n  parts[0] = Number(parts[0]).toLocaleString('en-US').replace(EN_US_GROUPING_REGEXP, groupingSeparator);\n\n  return parts.join(decimalSeparator);\n}\n"],"mappings":"oCAGA,MAAMA,EAA0E,CAC9EC,GAAI,CACFC,SAAU,IACVC,QAAS,MAGb,CAAC,KAAM,KAAM,KAAM,KAAM,SAASC,SAC/BC,GACEL,EAAiBK,GAAc,CAC9BH,SAAU,IACVC,QAAS,OAIf,IAAIG,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EACJ,SAASC,EAA+BC,GAEtC,MAAMC,EAAuBZ,EAAiBW,IAAST,UAAY,IACnE,MAAMW,EAAsBb,EAAiBW,IAASR,SAAW,IAEjE,GAAIS,IAAyBN,GAAqBO,IAAwBL,EAAkB,CAC1F,M,CAGFF,EAAoBM,EACpBJ,EAAmBK,EAEnBJ,EAAe,IAAIK,IAAI,CAACR,EAAmBE,KAAqB,eAChED,EAA0B,IAAIQ,OAAO,KAAKT,IAAqB,IACjE,CAEAI,EAA+BM,EAAMC,IAAI,UAAUN,QACnDK,EAAME,SAAS,UAAU,EAAGP,YAAaD,EAA+BC,KAElE,SAAUQ,EAAwBC,GACtC,IAAIC,EAAY,GAChB,IAAIC,EAAiC,MAErC,IAAK,MAAMC,KAAQH,EAAiB,CAClC,IAAKX,EAAae,IAAID,GAAO,CAC3B,Q,CAGF,GAAIA,IAASf,EAAkB,CAC7B,GAAIc,EAAgC,CAClC,K,CAEFA,EAAiC,I,CAEnCD,GAAaE,C,CAGf,OAAOF,CACT,CAEM,SAAUI,EAAqBL,GACnC,MAAMM,EAAeN,EAAgBO,QAAQpB,EAAyB,IAAIoB,QAAQnB,EAAkB,KACpG,OAAOkB,EAAeE,OAAOF,GAAgB,IAC/C,CAEA,MAAMG,EAAwB,IAAId,OAAO,IAAK,KAC9B,SAAAe,EAAwBC,EAAgBC,GACtD,IAAIC,EACJ,UAAWD,IAAc,SAAU,CACjCC,EAAQF,EAAOG,QAAQF,GAAWG,MAAM,I,KACnC,CACLF,EAAQG,OAAOL,GAAQI,MAAM,I,CAG/BF,EAAM,GAAKL,OAAOK,EAAM,IAAII,eAAe,SAASV,QAAQE,EAAuBvB,GAEnF,OAAO2B,EAAMK,KAAK9B,EACpB,Q","ignoreList":[]}