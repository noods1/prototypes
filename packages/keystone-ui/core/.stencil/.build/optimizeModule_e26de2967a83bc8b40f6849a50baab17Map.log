{"version":3,"names":["flattenDropdownItems","items","groupId","result","forEach","item","type","push","title","childrenTitles","children","id","internalRenderDynamicSlots","props","wrapWithSlot","renderVisItem","searchValue","renderedNodes","createSlot","itemId","tabId","renderFn","slotName","createAvatarIconSlot","pushRenderedNode","slotConfigs","renderContent","renderOptions","description","popover","render","extra","pushRenderedAvatarIcon","avatarIcon","pushRenderedTitle","renderTitle","pushDropdownItem","child","dataSource","getDropdownItemList","dropdownItem","list","isBoolean","virtual","filter","includes","tabs","tab","renderTab"],"sources":["src/utils/dropdown/index.ts"],"sourcesContent":["import { isBoolean } from 'lodash-es';\nimport {\n  DropdownMenuItem,\n  DropdownItem,\n  DropdownTab,\n  CustomRenderFn,\n  RenderContentFn,\n  DropdownGroupItem,\n} from '../../entities/components/dropdown';\nimport type { Components } from '@src/components';\n\n// 打平函数\nexport const flattenDropdownItems = (\n  items: DropdownItem[],\n  groupId?: string | number,\n): (DropdownMenuItem | string)[] => {\n  const result: (DropdownMenuItem | string)[] = [];\n\n  items.forEach((item) => {\n    if (item.type !== 'group') {\n      item.groupId = groupId;\n      result.push(item as DropdownMenuItem);\n    } else if (item.type === 'group') {\n      result.push(item.title || '');\n      const childrenTitles = flattenDropdownItems(item.children as DropdownItem[], item.id);\n      result.push(...childrenTitles);\n    }\n  });\n\n  return result;\n};\n\nexport const internalRenderDynamicSlots = (\n  props: Partial<Components.KsDropdownMenu>,\n  wrapWithSlot: (slotName: string, children: unknown) => unknown,\n  renderVisItem?: unknown[] | undefined | null,\n  searchValue?: string,\n) => {\n  // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n  const renderedNodes = [];\n  const createSlot = (\n    type: string,\n    itemId: string | number,\n    groupId?: string | number,\n    tabId?: string,\n    renderFn?: CustomRenderFn | RenderContentFn,\n  ) => {\n    const slotName = `slot-${type}-${itemId}${groupId ? '-' + groupId : ''}${tabId ? '-' + tabId : ''}`;\n    // FIXME 缺失一个 item hover 状态的参数，Ads Creation 2.0 中比较常用\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    return wrapWithSlot(slotName, type === 'content' ? renderFn(searchValue) : renderFn());\n  };\n  const createAvatarIconSlot = (type: string, itemId: string | number, renderFn?: CustomRenderFn) => {\n    const slotName = `slot-${type}-${itemId}`;\n    // FIXME 缺失一个 item hover 状态的参数，Ads Creation 2.0 中比较常用\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    return wrapWithSlot(slotName, renderFn());\n  };\n  const pushRenderedNode = (item: DropdownMenuItem, tabId?: string) => {\n    const slotConfigs = [\n      { renderFn: item.renderContent, type: 'content' },\n      { renderFn: item.renderOptions?.description, type: 'des' },\n      { renderFn: item.renderOptions?.popover?.render, type: 'pop' },\n      { renderFn: item.renderOptions?.extra, type: 'extra' },\n    ];\n    slotConfigs.forEach(({ renderFn, type }) => {\n      if (typeof renderFn === 'function') {\n        renderedNodes.push(createSlot(type, item.id, item.groupId, tabId, renderFn));\n      }\n    });\n  };\n  const pushRenderedAvatarIcon = (item: DropdownGroupItem) => {\n    const slotConfigs = [{ renderFn: item.avatarIcon, type: 'avatar-icon' }];\n    slotConfigs.forEach(({ renderFn, type }) => {\n      if (typeof renderFn === 'function') {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        renderedNodes.push(createAvatarIconSlot(type, item.id, renderFn));\n      }\n    });\n  };\n  const pushRenderedTitle = (item: DropdownGroupItem, tabId?: string) => {\n    if (typeof item.renderTitle === 'function') {\n      renderedNodes.push(wrapWithSlot(`slot-title-${item.id}${tabId ? '-' + tabId : ''}`, item.renderTitle()));\n    }\n  };\n  const pushDropdownItem = (item: DropdownItem, tabId?: string) => {\n    if (item.type === 'group') {\n      pushRenderedAvatarIcon(item);\n      pushRenderedTitle(item, tabId);\n      item.children.forEach((child) => {\n        child.groupId = item.id;\n        pushRenderedNode(child, tabId);\n      });\n    } else {\n      pushRenderedNode(item, tabId);\n    }\n  };\n\n  if (!props.dataSource) {\n    // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n    return renderedNodes;\n  }\n\n  const getDropdownItemList = (dropdownItem: DropdownItem[]) => {\n    let list = [];\n    if (isBoolean(props.virtual) && props.virtual) {\n      const items = flattenDropdownItems(dropdownItem);\n      list = items.filter((item) => typeof item !== 'string' && (renderVisItem || []).includes(item?.id));\n    } else {\n      list = dropdownItem;\n    }\n    return list;\n  };\n\n  if (props.dataSource?.type === 'list') {\n    const list = getDropdownItemList(props.dataSource?.items);\n    list.forEach((item) => {\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      pushDropdownItem(item);\n    });\n  } else if (props.dataSource?.type === 'tabs') {\n    props.dataSource?.tabs.forEach((tab: DropdownTab) => {\n      if (typeof tab.renderTab === 'function') {\n        renderedNodes.push(wrapWithSlot(`slot-tab-${tab.tabId}`, tab.renderTab()));\n      }\n      const list = getDropdownItemList(tab.items);\n      list.forEach((item) => {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        pushDropdownItem(item, tab.tabId);\n      });\n    });\n  }\n  // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n  return renderedNodes;\n};\n"],"mappings":"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","ignoreList":[]}