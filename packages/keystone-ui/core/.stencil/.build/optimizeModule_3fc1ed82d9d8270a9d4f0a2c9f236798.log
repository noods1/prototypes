import{d as t,e as s,f as i,j as e,k as a,r as h,h as n,H as r,a as o}from"./p-BVbYP5UG.js";import{d as l,t as c}from"./p-B9Bv72kO.js";import{F as d}from"./p-lK2WYNKL.js";import{C as f}from"./p-B7eN8IFF.js";import{P as u}from"./p-DXVWym72.js";import{d as p,i as b,p as m}from"./p-Cg-hFIOP.js";import{f as _}from"./p-CZoCRgNL.js";import{S as x}from"./p-DtH7945i.js";import{k as v}from"./p-DY__klQW.js";import{S as C}from"./p-CwVJOw7w.js";import"@oddbird/popover-polyfill";import"./p-BpTTFEEs.js";import"./p-BKnx-nkd.js";import"./p-3aNLeb18.js";import"./p-D53F0nW8.js";var g=Object.prototype;var k=g.hasOwnProperty;var w=t((function(t,h){if(s(h)||i(h)){e(h,v(h),t);return}for(var n in h){if(k.call(h,n)){a(t,n,h[n])}}}));const y="";var j=undefined&&undefined.__decorate||function(t,s,i,e){var a=arguments.length,h=a<3?s:e===null?e=Object.getOwnPropertyDescriptor(s,i):e,n;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")h=Reflect.decorate(t,s,i,e);else for(var r=t.length-1;r>=0;r--)if(n=t[r])h=(a<3?n(h):a>3?n(s,i,h):n(s,i))||h;return a>3&&h&&Object.defineProperty(s,i,h),h};const P="form-list";const F=class{constructor(t){h(this,t);this["ks-name"]="ks-form-list";this._keyManager={keys:[],id:0};this._mapValueToFields=t=>(t||[]).map(((t,s)=>{let i=this._keyManager.keys[s];if(i===undefined){this._keyManager.keys[s]=this._keyManager.id;i=this._keyManager.keys[s];this._keyManager.id+=1}return{name:s,key:i}}));this.add=(t,s)=>{const i=this.valueFromContext||[];if(s!==undefined&&s>=0&&s<=i.length){this._keyManager.keys=[...this._keyManager.keys.slice(0,s),this._keyManager.id,...this._keyManager.keys.slice(s)];const e=[...i.slice(0,s),t,...i.slice(s)];this.dispatchContextChange({...this.context,value:e});this.registerContextEffect((()=>{this.callbacksFromContext.onValueChange(e,this._relativePath(),[...this._prefixPath,...this._relativePath()]);if(this.validationStateFromContext){const t=[...this.validationStateFromContext.slice(0,s),[],...this.validationStateFromContext.slice(s)];t[C]=this.validationStateFromContext[C];this.callbacksFromContext._onValidationStatesChange(t,this._relativePath())}}))}else{this._keyManager.keys=[...this._keyManager.keys,this._keyManager.id];const s=[...i,t];this.dispatchContextChange({...this.context,value:s});this.registerContextEffect((()=>{this.callbacksFromContext.onValueChange(s,this._relativePath(),[...this._prefixPath,...this._relativePath()]);if(this.validationStateFromContext){const t=[...this.validationStateFromContext,[]];t[C]=this.validationStateFromContext[C];this.callbacksFromContext._onValidationStatesChange(t,this._relativePath())}}))}this._keyManager.id+=1};this.remove=t=>{const s=this.valueFromContext||[];const i=new Set(Array.isArray(t)?t:[t]);if(i.size<=0){return}else{this._keyManager.keys=this._keyManager.keys.filter(((t,s)=>!i.has(s)));const t=s.filter(((t,s)=>!i.has(s)));this.dispatchContextChange({...this.context,value:t});this.registerContextEffect((()=>{this.callbacksFromContext.onValueChange(t,this._relativePath(),[...this._prefixPath,...this._relativePath()]);if(this.validationStateFromContext){const t=this.validationStateFromContext[C];let e=w(new Array(s.length).fill(null),this.validationStateFromContext);e=e.filter(((t,s)=>!i.has(s)));e[C]=t;this.callbacksFromContext._onValidationStatesChange(e,this._relativePath())}}))}};this.move=(t,s)=>{if(t===s){return}const i=this.valueFromContext||[];if(t<0||t>=i.length||s<0||s>=i.length){return}this._keyManager.keys=p(this._keyManager.keys,t,s);const e=p(i,t,s);this.dispatchContextChange({...this.context,value:e});this.registerContextEffect((()=>{this.callbacksFromContext.onValueChange(e,this._relativePath(),[...this._prefixPath,...this._relativePath()]);if(this.validationStateFromContext){const e=this.validationStateFromContext[C];let a=w(new Array(i.length).fill(null),this.validationStateFromContext);a=p(a,t,s);a[C]=e;this.callbacksFromContext._onValidationStatesChange(a,this._relativePath())}}))};this._effects=[];this.registerContextEffect=t=>{this._effects.push(t)};this.dispatchContextChange=t=>{this.el.dispatchEvent(new CustomEvent("context-change",{detail:{context:t}}))};this.contextEffect=()=>{this._effects.forEach((t=>t()));this._effects=[]};this.__propsReady=new Promise((t=>{this.__propsReadyResolver=t}));this.context={_provider:"formList",_prefixPath:[],disabled:undefined,value:[],validationStates:{[C]:null},callbacks:{onValueChange:(t,s=[],i)=>{const e=b(this.context.value,s,t);i=i||[...this._prefixPath,...this._relativePath()];this.callbacksFromContext?.onValueChange(e,this._relativePath(),i)},onBlur:t=>{t=t||[...this._prefixPath,...this._relativePath()];this.callbacksFromContext?.onBlur(t)},onValidation:async(t=[])=>{await this.validate(t||[])},_onValidationStatesChange:(t,s=[])=>{const i=b(this.context.validationStates,s,t);this.callbacksFromContext?._onValidationStatesChange(i,this._relativePath())},onResetValidation:async(t=[])=>{await this.resetValidate(t||[])},_onComponentConnect:(t,s=[])=>{this.callbacksFromContext?._onComponentConnect(t,[...this._relativePath(),...s])},_onComponentDisconnect:(t,s=[])=>{this.callbacksFromContext?._onComponentDisconnect(t,[...this._relativePath(),...s])},_onPathChange:(t,s,i)=>{this.callbacksFromContext?._onPathChange(t,s,i)},_registerWatch:(t,s,i)=>this.callbacksFromContext?._registerWatch(t,s,i)},listUtils:{add:this.add,remove:this.remove,move:this.move,_mapValueToFields:this._mapValueToFields}};this.validateMessages=[];this._prefixPath=[];this.colon=false;this.size="md";this.rules=[];this.required=false;this.validateTrigger="change";this.showOption=true;this._disposers=[]}_relativePath({name:t=this.name,_prefixPath:s=this._prefixPath}={}){const i=m(t);if(i.slice(0,s.length).join(".")===s.join(".")){return i.slice(s.length)}else{return i}}updateContextValue(){this.context={...this.context,value:this.valueFromContext}}updateValidationState(){let t;const s=this.validationStateFromContext?.[C]||[];if(s.length){if(s.some((({status:t})=>t==="error"))){t="error"}else if(s.some((({status:t})=>t==="warning"))){t="warning"}else if(s.some((({status:t})=>t==="success"))){t="success"}else{t="default"}}else{t="default"}this.context={...this.context,status:t,validationStates:this.validationStateFromContext};this.validateMessages=(this.validationStateFromContext?.[C]||[]).filter((t=>t.status==="error"||t.status==="warning"))}validateStatusChange(){if(this.validateStatus){this.context={...this.context,status:this.validateStatus}}}watchContextPropsChange(){this.context={...this.context,_prefixPath:[...this._prefixPath,...this._relativePath()],disabled:this.disabledFromContext,labelWidth:this.labelWidthFromContext,labelAlign:this.labelAlignFromContext}}prefixChange(t,s){this.context={...this.context,_prefixPath:[...this._prefixPath,...this._relativePath()]};this.callbacksFromContext?._onPathChange?.(this,[...s,...this._relativePath()],[...t,...this._relativePath()])}nameChange(t,s){this.context={...this.context,_prefixPath:[...this._prefixPath,...this._relativePath()]};this.callbacksFromContext._onPathChange?.(this,this._relativePath({name:s}),this._relativePath({name:t}))}_collectRules(t){let s;if(this.required&&!this.rules.find((t=>t.required))){s=[{required:true},...this.rules]}else{s=this.rules}return s.filter((s=>{if(t===true){return true}const i=s.trigger||this.validateTrigger;return i===t||Array.isArray(i)&&i.includes(t)}))}_registerDependencies(){if(Array.isArray(this.dependencies)){this.dependencies.forEach((t=>{const s=this.callbacksFromContext._registerWatch(m(t),(t=>{this.validate().catch((()=>{}))}));this._disposers.push(s)}),false)}}_disposeDependencies(){this._disposers.forEach((t=>{t()}))}connectedCallback(){this.__propsReady.then((()=>{this.callbacksFromContext?._onComponentConnect?.(this,this._relativePath());this._registerDependencies()}))}disconnectedCallback(){this.callbacksFromContext._onComponentDisconnect?.(this,this._relativePath());this._disposeDependencies()}componentWillLoad(){this.__propsReadyResolver();this.context={...this.context,_prefixPath:[...this._prefixPath,...this._relativePath()],disabled:this.disabledFromContext,labelWidth:this.labelWidthFromContext,labelAlign:this.labelAlignFromContext,status:this.validateStatus}}async validate(t=[]){await(this.callbacksFromContext?.onValidation([...this._relativePath(),...t]))}async resetValidate(t=[]){this.callbacksFromContext?.onResetValidation([...this._relativePath(),...t])}render(){const t=this.labelAlign||this.labelAlignFromContext;const s=this.labelWidth||this.labelWidthFromContext;const i=this.showOption&&!this.required&&!this._collectRules(true).find((t=>t.required));return n(r,{key:"6cc5c11928d185f0dd82935458db54ab183d7bbe",dir:l(),"ks-form-item":true},n("div",{key:"7fc1a2b86c2b61dce7eda5523b62c51b3fcd1caf",dir:l(),class:{[P]:true,[`${P}--size-${this.size}`]:true},part:"self"},(this.label||this.labelSlot)&&n("label",{key:"3f15f4d065a25146d57eb87c3cbd88b3ecee01b8",class:{[`${P}__label`]:true,[`${P}__label--align-${t}`]:true},style:{width:`${s}px`},part:"label"},n("slot",{key:"670c5f7df337745ea85dcb989b2565462a1e30e8",name:"label"},this.label),this.colon&&":",i&&n("span",{key:"26cca0a8a6ba511d156c2c8e60287d808f8119c8",class:`${P}__label--optional`},` Â· ${c(_.optional)}`)),n("div",{key:"88bc9b41ec8a7f12915977a513daad96f54638e9",class:`${P}__control`,part:"control"},n("slot",{key:"2b61c6fedadfce42b924a0ea2e8e7dc6f94dbbeb"}),this.validateMessages.length&&n("div",{key:"b0a5d553c982f50d669daf5a5680f5a224d7f8cc",class:`${P}__control__message`,part:"controlMessage"},this.validateMessages.map((t=>{if(t.status==="error"||t.status==="warning"){return n("span",{class:{[`${P}__control__message__text`]:true,[`${P}__control__message__text--warning`]:t.status==="warning",[`${P}__control__message__text--error`]:t.status==="error"}},n("ks-status-message",{variant:t.status,richTextString:t.message,cta:t.cta}))}})))||null)))}get el(){return o(this)}static get watchers(){return{valueFromContext:["updateContextValue"],validationStateFromContext:["updateValidationState"],validateStatus:["validateStatusChange"],disabledFromContext:["watchContextPropsChange"],labelWidthFromContext:["watchContextPropsChange"],labelAlignFromContext:["watchContextPropsChange"],_prefixPath:["prefixChange"],name:["nameChange"]}}};j([u({context:d,callback:t=>{t?.dispatchEvent?.(new CustomEvent("context-change",{detail:t}))}})],F.prototype,"context",void 0);j([f({context:d,subscribe:true,path(){return["value",...this._relativePath()]}})],F.prototype,"valueFromContext",void 0);j([f({context:d,subscribe:true,path(){return["validationStates",...this._relativePath()]}})],F.prototype,"validationStateFromContext",void 0);j([f({context:d,subscribe:true,path:["_prefixPath"]})],F.prototype,"_prefixPath",void 0);j([f({context:d,subscribe:true,path:["disabled"]})],F.prototype,"disabledFromContext",void 0);j([f({context:d,subscribe:true,path:["labelAlign"]})],F.prototype,"labelAlignFromContext",void 0);j([f({context:d,subscribe:true,path:["labelWidth"]})],F.prototype,"labelWidthFromContext",void 0);j([f({context:d,subscribe:false,path:["callbacks"]})],F.prototype,"callbacksFromContext",void 0);j([x({slotname:"label"})],F.prototype,"labelSlot",void 0);F.style=y;export{F as ks_form_list};