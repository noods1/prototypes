{"version":3,"names":["safeRequestIdleCallback","callback","options","requestIdleCallback","setTimeout","safeCancelIdleCallback","id","cancelIdleCallback","clearTimeout","createDebouncedIdleCallback","callbackIdMap","WeakMap","el","existingCallbackId","get","undefined","delete","idleCallbackId","deadline","error","console","set","scheduleLowPriorityTask"],"sources":["src/utils/input/scheduleLowPriorityTask.ts"],"sourcesContent":["type ScheduleLowPriorityTask = (el: Element, callback: IdleRequestCallback, options?: IdleRequestOptions) => void;\n\n/**\n * SAFATI 不支持 requestIdleCallback 时的回退方案。\n * @param callback 空闲回调函数，当浏览器空闲时执行。\n * @param options 可选的配置对象，用于定制 requestIdleCallback 的行为。\n * @returns 如果浏览器支持 requestIdleCallback，则返回 requestIdleCallback 的调用结果；否则返回 setTimeout 的调用结果。\n */\nconst safeRequestIdleCallback = (callback: IdleRequestCallback, options?: IdleRequestOptions) => {\n  if (typeof requestIdleCallback === 'function') {\n    return requestIdleCallback(callback, options);\n  } else {\n    return setTimeout(callback, 16);\n  }\n};\n\nconst safeCancelIdleCallback = (id: number) => {\n  if (typeof cancelIdleCallback === 'function') {\n    cancelIdleCallback(id);\n  } else {\n    clearTimeout(id);\n  }\n};\n\n/**\n * 创建一个防抖版的 requestIdleCallback。\n * @returns 一个函数，用于调度防抖的空闲回调。\n */\nfunction createDebouncedIdleCallback(): ScheduleLowPriorityTask {\n  const callbackIdMap = new WeakMap<Element, number>();\n\n  /**\n   * 调度一个防抖的空闲回调。\n   * 如果已经有一个回调在等待执行，它将被取消，并用新的回调替换。\n   * @param el - 要关联的元素，用于取消之前的回调。\n   * @param callback - 当浏览器空闲时要执行的函数。\n   * @param options - requestIdleCallback 的可选配置对象。\n   */\n  return function (el: Element, callback: IdleRequestCallback, options?: IdleRequestOptions): void {\n    // 检查是否已有待执行的回调，如果有则取消\n    const existingCallbackId = callbackIdMap.get(el);\n    if (existingCallbackId !== undefined) {\n      safeCancelIdleCallback(existingCallbackId);\n      callbackIdMap.delete(el);\n    }\n\n    const idleCallbackId = safeRequestIdleCallback((deadline: IdleDeadline) => {\n      callbackIdMap.delete(el);\n      try {\n        callback(deadline);\n      } catch (error) {\n        console.error('Error in scheduled low priority task:', error);\n      }\n    }, options);\n\n    callbackIdMap.set(el, idleCallbackId);\n  };\n}\n\nexport const scheduleLowPriorityTask = createDebouncedIdleCallback();\n"],"mappings":"AAQA,MAAMA,EAA0B,CAACC,EAA+BC,KAC9D,UAAWC,sBAAwB,WAAY,CAC7C,OAAOA,oBAAoBF,EAAUC,E,KAChC,CACL,OAAOE,WAAWH,EAAU,G,GAIhC,MAAMI,EAA0BC,IAC9B,UAAWC,qBAAuB,WAAY,CAC5CA,mBAAmBD,E,KACd,CACLE,aAAaF,E,GAQjB,SAASG,IACP,MAAMC,EAAgB,IAAIC,QAS1B,OAAO,SAAUC,EAAaX,EAA+BC,GAE3D,MAAMW,EAAqBH,EAAcI,IAAIF,GAC7C,GAAIC,IAAuBE,UAAW,CACpCV,EAAuBQ,GACvBH,EAAcM,OAAOJ,E,CAGvB,MAAMK,EAAiBjB,GAAyBkB,IAC9CR,EAAcM,OAAOJ,GACrB,IACEX,EAASiB,E,CACT,MAAOC,GACPC,QAAQD,MAAM,wCAAyCA,E,IAExDjB,GAEHQ,EAAcW,IAAIT,EAAIK,EACxB,CACF,CAEa,MAAAK,EAA0Bb,W","ignoreList":[]}