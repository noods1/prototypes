import{a as t}from"./p-BVbYP5UG.js";import{C as s}from"./p-BKnx-nkd.js";import{g as e}from"./p-3aNLeb18.js";
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class i{get value(){return this._value}set value(t){this.setValue(t)}setValue(t,s=false){const i=this._value;this._value=t;for(const[t,{disposer:n,path:o}]of this.subscriptions){if(!o){if(s||!Object.is(this._value,i)){t(this._value,n)}}else if(o instanceof Promise){o.then((o=>{const h=e(this._value,o());const c=e(i,o());if(s||!Object.is(h,c)){t(h,n)}}))}else{const h=e(this._value,o);const c=e(i,o);if(s||!Object.is(h,c)){t(h,n)}}}}constructor(t){this.subscriptions=new Map;if(t!==undefined){this.value=t}}addCallback(t,s,i,n){if(!i){if(!n){t(this.value)}else if(n instanceof Promise){n.then((s=>{const i=e(this.value,s());t(i)}))}else{const s=e(this.value,n);t(s)}return}if(!this.subscriptions.has(t)){this.subscriptions.set(t,{disposer:()=>{this.subscriptions.delete(t)},consumerHost:s,path:n})}const{disposer:o}=this.subscriptions.get(t);if(!n){t(this.value,o)}else if(n instanceof Promise){n.then((s=>{const i=e(this.value,s());t(i,o)}))}else{const s=e(this.value,n);t(s,o)}}clearCallbacks(){this.subscriptions.clear()}}
/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class n extends Event{constructor(t){super("context-provider",{bubbles:true,composed:true});this.context=t}}class o extends i{constructor(t,e,i){super(e.context!==undefined?e.initialValue:i);this.onContextRequest=t=>{const s=t.composedPath()[0];if(t.context!==this.context||s===this.host){return}t.stopPropagation();this.addCallback(t.callback,s,t.subscribe,t.contextPath)};this.onProviderRequest=t=>{const e=t.composedPath()[0];if(t.context!==this.context||e===this.host){return}const i=new Set;for(const[t,{consumerHost:e,path:n}]of this.subscriptions){if(i.has(t)){continue}i.add(t);e.dispatchEvent(new s(this.context,t,true,n))}t.stopPropagation()};this.host=t;if(e.context!==undefined){this.context=e.context}else{this.context=e}this.attachListeners()}attachListeners(){this.host.addEventListener("context-request",this.onContextRequest);this.host.addEventListener("context-provider",this.onProviderRequest)}detachListeners(){this.host.removeEventListener("context-request",this.onContextRequest);this.host.removeEventListener("context-provider",this.onProviderRequest)}hostConnected(){this.host.dispatchEvent(new n(this.context))}hostDisconnected(){this.detachListeners();this.clearCallbacks()}}
/**
 * @license
 * Copyright 2024 ByteDance Inc.
 */function h({context:s,callback:e}){return(i,n)=>{const h=new WeakMap;const c=new WeakMap;const r=i.connectedCallback;const f=i.disconnectedCallback;i.connectedCallback=function(){const e=new o(t(this),{context:s,initialValue:this[n]});this.controller=e;h.set(t(this),e);const i=c.get(t(this));if(i!==undefined){e.setValue(i);c.delete(t(this))}e.hostConnected();if(r){r.call(this)}};i.disconnectedCallback=function(){const s=h.get(t(this));if(s){s.hostDisconnected();h.delete(t(this))}if(f){f.call(this)}};const a=Object.getOwnPropertyDescriptor(i,n);let u;if(a===undefined){const s=new WeakMap;u={get(){return s.get(t(this))},set(i){const n=h.get(t(this));if(n){n.setValue(i)}else{c.set(t(this),i)}s.set(t(this),i);e?.(this,i)},configurable:true,enumerable:true}}else{const s=a.set;u={...a,set(i){h.get(t(this)).setValue(i);s?.call(this,i);e?.(this,i)}}}Object.defineProperty(i,n,u)}}export{h as P};