import{r as e,c as t,h as s,H as i,a}from"./p-BVbYP5UG.js";import{c as r}from"./p-BLeWSNPN.js";import{c as o,d,t as n}from"./p-B9Bv72kO.js";import{S as l}from"./p-BKUY4ePQ.js";import{E as c,T as h}from"./p-ClUjZ4dQ.js";import{S as p}from"./p-DtH7945i.js";import{g as f}from"./p-Cg-hFIOP.js";import{V as u}from"./p-DTAuyNBn.js";import{r as m}from"./p-DOsoKeKK.js";import{s as b,a as y,b as k}from"./p-DQMKCe7v.js";import{c as v,s as g}from"./p-CZoCRgNL.js";import{F as x}from"./p-CkSrI1o0.js";import{F as _}from"./p-C5l2lh22.js";import"@oddbird/popover-polyfill";import"./p-B85MJLTf.js";import"./p-BpTTFEEs.js";import"./p-B0FO8VRg.js";import"./p-D53F0nW8.js";import"./p-lK2WYNKL.js";import"./p-BKnx-nkd.js";import"./p-B7eN8IFF.js";import"./p-DXVWym72.js";import"./p-3aNLeb18.js";const w='@charset "UTF-8";ul,li{list-style:none;margin:0;padding:0}button{border:none;margin:0;padding:0;width:auto;overflow:visible;background:transparent;color:inherit;font:inherit;line-height:normal;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none}button::-moz-focus-inner{border:0;padding:0}.ks-text-bodyMd{font-size:var(--ks-text-bodyMd-fontSize);line-height:var(--ks-text-bodyMd-lineHeight);font-weight:var(--ks-text-bodyMd-fontWeight);letter-spacing:var(--ks-text-bodyMd-letterSpacing);font-family:var(--ks-text-bodyMd-fontFamily)}@keyframes breathing-opacity{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}.ks-skeleton,.animate-pulse{background-color:var(--ks-color-neutral-surface3);border-radius:var(--ks-border-radius-sm);animation-name:breathing-opacity;animation-duration:2s;animation-timing-function:cubic-bezier(0.455, 0, 0.55, 1);animation-fill-mode:forwards;animation-iteration-count:infinite}.ks-card-section{margin-bottom:var(--ks-spacing-400);font-size:var(--ks-text-titleMd-fontSize);line-height:var(--ks-text-titleMd-lineHeight);font-weight:var(--ks-text-titleMd-fontWeight);letter-spacing:var(--ks-text-titleMd-letterSpacing);font-family:var(--ks-text-titleMd-fontFamily)}*,:host{box-sizing:border-box}:host{display:inline-flex;--ks-comp-size-cascader-popper:953px}.cascader__arrow{transition:transform var(--ks-transition-functionalLong)}.cascader__arrow--open{transform:rotate(180deg)}.cascader__searchinput::part(self){border:none;box-shadow:none}.cascader__searchinput::part(content){padding:0 var(--ks-spacing-200)}.cascader__selected-box{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--ks-text-bodySm-fontSize);line-height:var(--ks-text-bodySm-lineHeight);font-weight:var(--ks-text-bodySm-fontWeight);letter-spacing:var(--ks-text-bodySm-letterSpacing);font-family:var(--ks-text-bodySm-fontFamily)}.cascader::part(popper){max-width:var(--ks-comp-size-cascader-popper)}.cascader::part(body){overflow:hidden;border-radius:var(--ks-border-radius-xl);box-shadow:var(--ks-elevation-shadow-level3)}.cascader__columns{padding:var(--ks-spacing-100) 0}.cascader__divider::part(self){margin:var(--ks-spacing-100) 0}.cascader__suffix{display:flex;flex-direction:row;gap:var(--ks-spacing-200)}.cascader__suffix[dir=ltr]{margin-right:-4px}.cascader__suffix[dir=rtl]{margin-left:-4px}.cascader__suffix--multiple{display:flex;flex-direction:row;gap:var(--ks-spacing-200)}.cascader__suffix--multiple[dir=ltr]{margin-right:4px}.cascader__suffix--multiple[dir=rtl]{margin-left:4px}';var S=undefined&&undefined.__decorate||function(e,t,s,i){var a=arguments.length,r=a<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(e,t,s,i);else for(var d=e.length-1;d>=0;d--)if(o=e[d])r=(a<3?o(r):a>3?o(t,s,r):o(t,s))||r;return a>3&&r&&Object.defineProperty(t,s,r),r};const j="cascader";const K=class extends x{datasourceWatcher(e){this.datasourceMap=this.treeMap?.createData(e);this.columnsEl?.initColumnList(this.value,this.datasourceMap,e)}valueWatcher(e){if(this.selectedFullValue!==e){this.selectedFullValue=e;this.columnsEl?.initColumnList(e,this.datasourceMap,this.dataSource)}}defaultValueWatcher(e){if(this.value===undefined&&this.selectedFullValue!==e){this.selectedFullValue=e;this.columnsEl?.initColumnList(e,this.datasourceMap,this.dataSource)}}async close(){await(this.popoverEl?.close())}constructor(s){super();e(this,s);this.ksChange=t(this,"ksChange",1);this.ksVisibleChange=t(this,"ksVisibleChange",1);this.ksSearchChange=t(this,"ksSearchChange",1);this["ks-name"]="ks-cascader";this.valueKey="value";this.labelKey="label";this.childrenKey="children";this.disabledKey="disabled";this.needLoadKey="needLoad";this.searchable=false;this.ignoreCase=false;this.panelHeight="248px";this.dataSource=[];this.processSelected=(e=[])=>e.join("/");this.width="288px";this.columnMinWidth="288px";this.fullpath=false;this.searchDebounceTime=0;this.size="md";this.dropVisible=false;this.queryString="";this.searchResultList=[];this._searchController=new l(this);this.inputMouseEnter=false;m(this.el)}async updateSelectedFullValue(e){try{if(this.value===undefined){this.selectedFullValue=await this.treeMap.singleSelect(e,this.checkStrategy)}this.ksChange?.emit(e[c.FULL_VALUE_KEY]);this.popoverEl?.close();b(this.el,{eventType:"change",componentParams:{value:e[c.FULL_VALUE_KEY]}})}catch(t){this.columnsEl.updateColumnList(e);this.queryString=""}}clearSelectFullValue(){this.selectedFullValue=undefined;this.ksChange?.emit(undefined);b(this.el,{eventType:"change",componentParams:{value:undefined}})}visibleChangeHandler({detail:e}){this.dropVisible=e;this.ksVisibleChange?.emit(e);if(e){y(this.el,{eventType:"popup"});k(this.el,{eventType:"popup",reset:true})}else{k(this.el,{eventType:"popup"})}}popoverAnimeFinished(){this.columnsEl?.updateScrollIntoView()}searchValueWatcher(e){this.queryString=e}queryStringWatcher(e){this._searchController.debouncedSearch(e)}showSearchPanel(){return this.searchable&&this.queryString}renderDefaultSelected(){const e=this.el?.querySelectorAll("[slot=selected]");e?.forEach((e=>{this.el?.removeChild(e)}));const t=this.datasourceMap[this.selectedFullValue];const s=t!==undefined?this.renderSelected(t):document.createElement("div");if(o(s)){s.slot="selected";this.el?.appendChild(s)}else{throw Error("[Keystone]: Please ensure that renderSelected return is a valid dom node.")}}componentWillLoad(){this.treeMap=new h({fullpathMode:this.fullpath,valueKey:this.valueKey,labelKey:this.labelKey,childrenKey:this.childrenKey});this.datasourceMap=this.treeMap.createData([])}componentDidLoad(){this.datasourceWatcher(this.dataSource);if(this.value!==undefined){this.valueWatcher(this.value)}else{this.valueWatcher(this.defaultValue)}this.queryString=this.searchValue||this.queryString;requestAnimationFrame((()=>{this.fieldPresenterWidth=this.fieldPresenterEl?.getBoundingClientRect().width+"px"}))}render(){const e=this.processSelected(this.datasourceMap[this.selectedFullValue]?.[c.LABEL_FULL_PATH_KEY]);this.renderSelected!==undefined&&this.renderDefaultSelected();const{disabled:t,status:a}=f(this);return s(i,{key:"9aae7869e0a4d54615047c47d44b37062dbf97ec",dir:d(),"ks-cascader":true},s("ks-tooltip",{key:"79405f21521f6cddf45381025d6a58ca8735c301",ref:e=>{this.popoverEl=e},trigger:"click",dir:d(),class:j,placement:"bottom-start",noArrow:true,onKsVisibleChange:this.visibleChangeHandler.bind(this),onKsAfterOpen:this.popoverAnimeFinished.bind(this),part:"self","data-testid":"ks-cascader-index-d5vzY1"},s("div",{key:"26c5aa275380fe86472438537f9eeb18468bd486",slot:"body",part:"panel"},s("div",{key:"96ad141dce7cc62a6cb258113a8269eb30b7ce34"},s("slot",{key:"e3deb4659c5771bfd01e49835430ad118814c71d",name:"panel-header"})),this.searchable?[s("ks-input",{class:`${j}__searchinput`,value:this.queryString,placeholder:this.searchPlaceholder??n(v.placeholder),onKsChange:this._searchController.searchChangeHandler,part:"search-input","data-testid":"ks-cascader-index-dkaEii"},s("ks-icon-search",{size:"14",slot:"suffix"})),s("ks-divider",{class:`${j}__divider`})]:undefined,s("ks-cascader-searchlist",{key:"4c257d3d28899d0a3913252dab25b991402f5c47",style:{display:this.showSearchPanel()?"block":"none"},queryString:this.queryString,disabled:t,valueKey:this.valueKey,labelKey:this.labelKey,disabledKey:this.disabledKey,displayWidth:this.fieldPresenterWidth,panelHeight:this.panelHeight,treeMap:this.treeMap,dataSource:this.searchResultList,datasourceMap:this.datasourceMap,selectedFullValue:this.selectedFullValue,updateSelectedFullValue:this.updateSelectedFullValue.bind(this)}),s("ks-cascader-columns",{key:"064256f17489108851b60b7de225099a7a3cd296",class:`${j}__columns`,ref:e=>{this.columnsEl=e},style:{display:this.showSearchPanel()?"none":"block"},disabled:t,valueKey:this.valueKey,labelKey:this.labelKey,childrenKey:this.childrenKey,disabledKey:this.disabledKey,needLoadKey:this.needLoadKey,displayWidth:this.fieldPresenterWidth,columnMinWidth:this.columnMinWidth,panelHeight:this.panelHeight,treeMap:this.treeMap,datasourceMap:this.datasourceMap,selectedFullValue:this.selectedFullValue,updateSelectedFullValue:this.updateSelectedFullValue.bind(this),load:this.load,loadMore:this.loadMore}),s("div",{key:"3279df004d61fa5bc62088ff260a7b208e8aaa53"},s("slot",{key:"34b0296d72b3eb2c6c061bda97dc3f6d641eddff",name:"panel-footer"}))),s("div",{key:"10bfea4468717c146fbcd700d2b05a30ce37735c",style:{width:this.width}},s("slot",{key:"9467e41b53cf81c00fecb31e0dfe3a8ba6ff3370"},s("ks-fields-presenter",{key:"201c7db04ee2b19dbc40705b9e777980bc3ffb26",ref:e=>this.fieldPresenterEl=e,size:this.size,width:this.width,collapse:true,value:this.selectedFullValue?[{key:this.selectedFullValue.toString(),label:e}]:[],focusElement:this.dropVisible,status:a,maxHeight:256,removable:false,renderTag:e=>s("ks-text",{variant:"bodySm",ellipsis:true},e.label),placeholder:this.placeholder??n(g.placeholder),clearable:this.clearable,disabled:t,innerPaddingUse:true,onKsClear:()=>{this.clearSelectFullValue()},"data-testid":"ks-cascader-index-afp1uc"},s("slot",{key:"1916dfe533039c6b53fd5ab41e0d0bd034db42f7",name:"selected"},s("div",{key:"0be68bc7ed1cf078da069d458662ec99dea6f73e",class:`${j}__selected-box`},e)),this.prefixSlot?s("slot",{name:"prefix",slot:"prefix"}):undefined,s("div",{key:"cf763c8f1c9920b714ad64915e2c59172cd2e657",slot:"suffix",dir:d(),class:`${j}__suffix`},this.suffixSlot&&s("slot",{key:"c6c1c9c6f403025ffada10b87b583e86aad0dc98",name:"suffix"}),this.showIconSlot?s("slot",{name:"show-icon"}):s("ks-icon-chevron-down",{size:"xs",class:r(`${j}__arrow`,{[`${j}__arrow--open`]:this.dropVisible})})),this.clearIconSlot&&s("slot",{key:"b242316e472c966940738aa434cdd792b671d63a",name:"close-icon",slot:"close-icon"}))))))}get el(){return a(this)}static get watchers(){return{dataSource:["datasourceWatcher"],value:["valueWatcher"],defaultValue:["defaultValueWatcher"],searchValue:["searchValueWatcher"],queryString:["queryStringWatcher"]}}};S([u(),_()],K.prototype,"value",void 0);S([p({slotname:"prefix"})],K.prototype,"prefixSlot",void 0);S([p({slotname:"show-icon"})],K.prototype,"showIconSlot",void 0);S([p({slotname:"close-icon"})],K.prototype,"clearIconSlot",void 0);S([p({slotname:"suffix"})],K.prototype,"suffixSlot",void 0);K.style=w;export{K as ks_cascader};