import{r as e,c as t,t as s,h as i,H as a,a as r}from"./p-BVbYP5UG.js";import{c as o}from"./p-BLeWSNPN.js";import{c as l,d as h,t as c}from"./p-B9Bv72kO.js";import{T as n,E as d}from"./p-ClUjZ4dQ.js";import{S as p}from"./p-BKUY4ePQ.js";import{S as f}from"./p-DtH7945i.js";import{g as u}from"./p-Cg-hFIOP.js";import{V as m}from"./p-DTAuyNBn.js";import{c as b,s as y}from"./p-CZoCRgNL.js";import{F as g}from"./p-CkSrI1o0.js";import{F as k}from"./p-C5l2lh22.js";import"@oddbird/popover-polyfill";import"./p-B85MJLTf.js";import"./p-BpTTFEEs.js";import"./p-B0FO8VRg.js";import"./p-D53F0nW8.js";import"./p-lK2WYNKL.js";import"./p-BKnx-nkd.js";import"./p-B7eN8IFF.js";import"./p-DXVWym72.js";import"./p-3aNLeb18.js";function v(e,t){return t.length===e.size&&t.every((t=>e.has(t)))}const x='@charset "UTF-8";ul,li{list-style:none;margin:0;padding:0}button{border:none;margin:0;padding:0;width:auto;overflow:visible;background:transparent;color:inherit;font:inherit;line-height:normal;-webkit-font-smoothing:inherit;-moz-osx-font-smoothing:inherit;-webkit-appearance:none}button::-moz-focus-inner{border:0;padding:0}.ks-text-bodyMd{font-size:var(--ks-text-bodyMd-fontSize);line-height:var(--ks-text-bodyMd-lineHeight);font-weight:var(--ks-text-bodyMd-fontWeight);letter-spacing:var(--ks-text-bodyMd-letterSpacing);font-family:var(--ks-text-bodyMd-fontFamily)}@keyframes breathing-opacity{0%{opacity:1}50%{opacity:0.5}100%{opacity:1}}.ks-skeleton,.animate-pulse{background-color:var(--ks-color-neutral-surface3);border-radius:var(--ks-border-radius-sm);animation-name:breathing-opacity;animation-duration:2s;animation-timing-function:cubic-bezier(0.455, 0, 0.55, 1);animation-fill-mode:forwards;animation-iteration-count:infinite}.ks-card-section{margin-bottom:var(--ks-spacing-400);font-size:var(--ks-text-titleMd-fontSize);line-height:var(--ks-text-titleMd-lineHeight);font-weight:var(--ks-text-titleMd-fontWeight);letter-spacing:var(--ks-text-titleMd-letterSpacing);font-family:var(--ks-text-titleMd-fontFamily)}*,:host{box-sizing:border-box}:host{display:inline-flex;--ks-comp-size-cascader-popper:953px}.cascader__arrow{transition:transform var(--ks-transition-functionalLong)}.cascader__arrow--open{transform:rotate(180deg)}.cascader__searchinput::part(self){border:none;box-shadow:none}.cascader__searchinput::part(content){padding:0 var(--ks-spacing-200)}.cascader__selected-box{display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-size:var(--ks-text-bodySm-fontSize);line-height:var(--ks-text-bodySm-lineHeight);font-weight:var(--ks-text-bodySm-fontWeight);letter-spacing:var(--ks-text-bodySm-letterSpacing);font-family:var(--ks-text-bodySm-fontFamily)}.cascader::part(popper){max-width:var(--ks-comp-size-cascader-popper)}.cascader::part(body){overflow:hidden;border-radius:var(--ks-border-radius-xl);box-shadow:var(--ks-elevation-shadow-level3)}.cascader__columns{padding:var(--ks-spacing-100) 0}.cascader__divider::part(self){margin:var(--ks-spacing-100) 0}.cascader__suffix{display:flex;flex-direction:row;gap:var(--ks-spacing-200)}.cascader__suffix[dir=ltr]{margin-right:-4px}.cascader__suffix[dir=rtl]{margin-left:-4px}.cascader__suffix--multiple{display:flex;flex-direction:row;gap:var(--ks-spacing-200)}.cascader__suffix--multiple[dir=ltr]{margin-right:4px}.cascader__suffix--multiple[dir=rtl]{margin-left:4px}';var S=undefined&&undefined.__decorate||function(e,t,s,i){var a=arguments.length,r=a<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,s):i,o;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r=Reflect.decorate(e,t,s,i);else for(var l=e.length-1;l>=0;l--)if(o=e[l])r=(a<3?o(r):a>3?o(t,s,r):o(t,s))||r;return a>3&&r&&Object.defineProperty(t,s,r),r};const w="cascader";const _=class extends g{constructor(s){super();e(this,s);this.ksChange=t(this,"ksChange",1);this.ksVisibleChange=t(this,"ksVisibleChange",1);this.ksSearchChange=t(this,"ksSearchChange",1);this["ks-name"]="ks-multiple-cascader";this.valueKey="value";this.labelKey="label";this.childrenKey="children";this.disabledKey="disabled";this.needLoadKey="needLoad";this.showAllKey="showAll";this.value=[];this.searchable=false;this.searchDebounceTime=0;this.ignoreCase=false;this.panelHeight="192px";this.dataSource=[];this.processSelected=(e=[])=>e[e.length-1];this.width="288px";this.columnMinWidth="288px";this.fullpath=false;this.checkStrategy="parent";this.size="md";this._treeMap=new n({fullpathMode:this.fullpath,valueKey:this.valueKey,labelKey:this.labelKey,childrenKey:this.childrenKey});this._datasourceMap=this._treeMap.createData([]);this.selectedFullValue=new Set;this.dropVisible=false;this.queryString="";this.searchResultList=[];this._searchController=new p(this);this.inputMouseEnter=false}datasourceWatcher(e){if(this.datasourceMap){return}this._datasourceMap=this._treeMap.createData(e);this.rectifySelectValue(this.selectedFullValue.size?Array.from(this.selectedFullValue):this.value);this.columnsEl?.initColumnList(Array.from(this.selectedFullValue)[0],this._datasourceMap,e)}datasourceMapWatcher(e){this._datasourceMap=e}treeMapWatcher(e){this._treeMap=e}valueWatcher(e){const t=v(this.selectedFullValue,Array.isArray(e)?e:[e]);if(!t){this.rectifySelectValue(e)}}async initColumnList(e=Array.from(this.selectedFullValue)[0],t=this._datasourceMap,s=this.dataSource){this.columnsEl?.initColumnList(e,t,s)}async close(){await(this.popoverEl?.close())}rectifySelectValue(e){if(!(e instanceof Array)){return}this.selectedFullValue=new Set;e.forEach((e=>{this._datasourceMap[e]&&this.addSelectedFullValue(this._datasourceMap[e],true)}));if(!v(this.selectedFullValue,e)){this.selectedFullValue=new Set(e);this.ksChange?.emit(e)}}addSelectedFullValue(e,t){this._treeMap.multipleAddSelect(e,this.selectedFullValue,this.checkStrategy);s(this.el);!t&&this.ksChange?.emit(Array.from(this.selectedFullValue))}removeSelectedFullValue(e,t){this._treeMap.multipleRemoveSelect(e,this.selectedFullValue,this.checkStrategy);s(this.el);!t&&this.ksChange?.emit(Array.from(this.selectedFullValue))}clearSelectFullValue(){this.selectedFullValue=new Set;this.ksChange?.emit([])}visibleChangeHandler({detail:e}){this.dropVisible=e;this.ksVisibleChange?.emit(e)}popoverAnimeFinished(){this.columnsEl?.updateScrollIntoView()}searchValueWatcher(e){this.queryString=e}queryStringWatcher(e){this._searchController.debouncedSearch(e)}showSearchPanel(){return this.searchable&&this.queryString}renderDefaultSelected(){const e=this.el?.querySelectorAll("[slot=selected]");e?.forEach((e=>{this.el?.removeChild(e)}));const t=[];this.selectedFullValue.forEach((e=>{t.push(this._datasourceMap[e])}));const s=t.length?this.renderSelected(t):document.createElement("div");if(l(s)){s.slot="selected";this.el?.appendChild(s)}else{throw Error("[Keystone]: Please ensure that renderSelected return is a valid dom node.")}}componentDidLoad(){this._datasourceMap=this.datasourceMap||this._treeMap.createData(this.dataSource);this._treeMap=this.treeMap||this._treeMap;this.queryString=this.searchValue||this.queryString;Object.keys(this._datasourceMap).length&&this.rectifySelectValue(this.value);this.columnsEl?.initColumnList(Array.from(this.selectedFullValue)[0],this._datasourceMap,this.dataSource)}render(){this.renderSelected!==undefined&&this.renderDefaultSelected();const{disabled:e,status:t}=u(this);return i(a,{key:"4615c8e80877a55dc5f39bcc3cdfcb682845e021",dir:h(),"ks-multiple-cascader":true},i("ks-tooltip",{key:"c44f8cf4573f1ca066fea01c019b9d93d6f7a5ff",class:w,ref:e=>{this.popoverEl=e},trigger:"click",dir:h(),placement:"bottom-start",noArrow:true,onKsVisibleChange:this.visibleChangeHandler.bind(this),onKsAfterOpen:this.popoverAnimeFinished.bind(this),part:"self","data-testid":"multiple-index-3cjbpS"},i("div",{key:"f850ea124078c3671c2e819b6828a3ac63a8e4ef",class:`${w}__panel`,slot:"body",part:"panel"},i("div",{key:"e5b2af332c15e38b8fcd4facb5b6c9bcd9e68caf"},i("slot",{key:"501569757c90d3244bbaffcd925df2b1725c48a5",name:"panel-header"})),this.searchable?[i("ks-input",{class:`${w}__searchinput`,value:this.queryString,placeholder:this.searchPlaceholder??c(b.placeholder),onKsChange:this._searchController.searchChangeHandler,part:"search-input","data-testid":"multiple-index-jMeWjK"},i("ks-icon-search",{size:"14",slot:"prefix"})),i("ks-divider",null)]:undefined,i("ks-cascader-searchlist",{key:"6270e96ec0f44b1580752ec8d92274cce4c91ae0",style:{display:this.showSearchPanel()?"block":"none"},multiple:true,queryString:this.queryString,disabled:e,valueKey:this.valueKey,labelKey:this.labelKey,disabledKey:this.disabledKey,displayWidth:this.width,panelHeight:this.panelHeight,checkStrategy:this.checkStrategy,treeMap:this._treeMap,dataSource:this.searchResultList,datasourceMap:this._datasourceMap,selectedFullValue:this.selectedFullValue,addSelectedFullValue:this.addSelectedFullValue.bind(this),removeSelectedFullValue:this.removeSelectedFullValue.bind(this)}),i("ks-cascader-columns",{key:"a8bc53d388bafb6cce2e2dd9669822ae39482121",ref:e=>{this.columnsEl=e},style:{display:this.showSearchPanel()?"none":"block"},class:`${w}__columns`,multiple:true,disabled:e,valueKey:this.valueKey,labelKey:this.labelKey,childrenKey:this.childrenKey,disabledKey:this.disabledKey,needLoadKey:this.needLoadKey,showAllKey:this.showAllKey,checkStrategy:this.checkStrategy,showAll:this.showAll,displayWidth:this.width,columnMinWidth:this.columnMinWidth,panelHeight:this.panelHeight,treeMap:this._treeMap,datasourceMap:this._datasourceMap,selectedFullValue:this.selectedFullValue,addSelectedFullValue:this.addSelectedFullValue.bind(this),removeSelectedFullValue:this.removeSelectedFullValue.bind(this),load:this.load,loadMore:this.loadMore,rectifySelectValue:()=>{this.rectifySelectValue(Array.from(this.selectedFullValue))}}),i("div",{key:"6ecbbdbeddc1c88b1bceba0dd73f74079c8d0650"},i("slot",{key:"421e07cd2a71eab5f1022612dacf7fcba5be3418",name:"panel-footer"}))),i("div",{key:"fa8b2c9cbef8387a316a5a764701acaff85439aa",style:{width:this.width}},i("slot",{key:"748805286156a3e5e03cb6f9089b430f2386be72"},i("ks-fields-presenter",{key:"f9b15fa0171c44c3500db13a915a47959044a84a",ref:e=>this.presenterEl=e,size:this.size,width:this.width,collapse:true,value:Array.from(this.selectedFullValue).map((e=>({key:e.toString(),label:this.processSelected(this._datasourceMap[e]?.[d.LABEL_FULL_PATH_KEY])}))),focusElement:this.dropVisible,status:t,maxHeight:200,onKsRemove:({detail:e})=>{const t=Array.isArray(e)?e:[e];t.forEach((e=>{this.removeSelectedFullValue(this._datasourceMap[e.key])}))},placeholder:this.placeholder??c(y.placeholder),disabled:e,clearable:this.clearable,part:"fields-presenter",onKsClear:()=>{this.clearSelectFullValue()},"data-testid":"multiple-index-hngTH6"},this.renderSelected!==undefined?i("slot",{name:"selected"}):undefined,this.prefixSlot?i("slot",{name:"prefix",slot:"prefix"}):undefined,i("div",{key:"8508c3c4c47a254b5d79a9b5cd572381c356a1e2",slot:"suffix",dir:h(),class:`${w}__suffix--multiple`},this.suffixSlot&&i("slot",{key:"576b831cc43996b040e5cb34f08c96c1c26f70fd",name:"suffix"}),this.showIconSlot?i("slot",{name:"show-icon"}):i("ks-icon-chevron-down",{size:"xs",class:o(`${w}__arrow`,{[`${w}__arrow--open`]:this.dropVisible})})),this.clearIconSlot&&i("slot",{key:"bcb326553460b6068a3e8b936238262b2df0f81e",name:"close-icon",slot:"close-icon"}))))))}get el(){return r(this)}static get watchers(){return{dataSource:["datasourceWatcher"],datasourceMap:["datasourceMapWatcher"],treeMap:["treeMapWatcher"],value:["valueWatcher"],searchValue:["searchValueWatcher"],queryString:["queryStringWatcher"]}}};S([m(),k()],_.prototype,"value",void 0);S([f({slotname:"prefix"})],_.prototype,"prefixSlot",void 0);S([f({slotname:"show-icon"})],_.prototype,"showIconSlot",void 0);S([f({slotname:"close-icon"})],_.prototype,"clearIconSlot",void 0);S([f({slotname:"suffix"})],_.prototype,"suffixSlot",void 0);_.style=x;export{_ as ks_multiple_cascader};