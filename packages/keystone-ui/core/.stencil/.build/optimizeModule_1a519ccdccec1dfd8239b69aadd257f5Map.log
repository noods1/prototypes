{"version":3,"names":["mountFunctionOnClick","elements","func","handler","e","stopPropagation","forEach","element","addEventListener","dispose","removeEventListener","getSubmitBtns","node","Array","prototype","filter","call","querySelectorAll","item","getAttribute","htmlType","getResetBtns","getReconciledFormContextData","disabled","undefined","disabledFromContext","status","statusFromContext","move","array","moveIndex","toIndex","length","diff","slice","parsePath","pathStr","pathRegex","result","match","exec","push","immutableSet","originalValue","path","valueToSet","defaultValue","keys","isArray","Object","Error","newValue","reduce","acc","key","assign","current","i","nextKey","nextNode","newNode","Number","isInteger","parseInt","lastKey","getAllPaths","obj","excludes","traverse","currentObj","currentPath","index","test","toString","newPath","hasOwnProperty"],"sources":["src/utils/form/utils.ts"],"sourcesContent":["import { Status } from '@src/entities';\nimport { HTMLCustomElement } from '../utils';\nexport { FormContextValueReconcile } from './FormContextValueReconcile';\n\n/**\n * @locale {en} Mount click event handlers on elements\n * @locale {zh} 在元素上绑定点击事件处理函数\n * @param elements 元素数组\n * @param func 点击事件回调\n */\nexport function mountFunctionOnClick(elements: HTMLElement[], func: (e: Event) => void) {\n  const handler = (e: Event) => {\n    e.stopPropagation();\n    func(e);\n  };\n\n  elements.forEach((element) => {\n    element.addEventListener('click', handler);\n  });\n\n  const dispose = () => {\n    elements.forEach((element) => {\n      element.removeEventListener('click', handler);\n    });\n  };\n\n  return dispose;\n}\n\n/**\n * @locale {en} Get buttons with submit attribute under form\n * @locale {zh} 获取 form 下具有 submit 属性的按钮\n * @param node form 元素\n */\nexport function getSubmitBtns(node: HTMLElement): HTMLElement[] {\n  return Array.prototype.filter.call(\n    node.querySelectorAll('*'),\n    (item: HTMLCustomElement) =>\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      item['ks-name'] === 'ks-button' && (item.getAttribute('html-type') ?? item.htmlType) === 'submit',\n  );\n}\n\n/**\n * @locale {en} Get buttons with reset attribute under form\n * @locale {zh} 获取 form 下具有 reset 属性的按钮\n * @param node form 元素\n */\nexport function getResetBtns(node: HTMLElement): HTMLElement[] {\n  return Array.prototype.filter.call(\n    node.querySelectorAll('*'),\n    (item: HTMLCustomElement) =>\n      // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n      item['ks-name'] === 'ks-button' && (item.getAttribute('html-type') ?? item.htmlType) === 'reset',\n  );\n}\n\n/**\n * @locale {en} Get\n * @locale {zh} 获取 form 子元素各值\n * @param node form child 元素\n */\nexport function getReconciledFormContextData(node: {\n  _provider?: 'formItem' | 'formList' | 'form';\n  disabled?: boolean;\n  status?: Status;\n  disabledFromContext?: boolean;\n  statusFromContext?: Status;\n}) {\n  const disabled = node?.disabled === undefined ? node?.disabledFromContext : node?.disabled;\n  const status = node?.status === undefined ? node?.statusFromContext : node?.status;\n  return {\n    disabled,\n    status,\n  };\n}\n\n/**\n * Moves an array item from one position in an array to another.\n *\n * Note: This is a pure function so a new array will be returned, instead\n * of altering the array argument.\n *\n * @param array         Array in which to move an item.         (required)\n * @param moveIndex     The index of the item to move.          (required)\n * @param toIndex       The index to move item at moveIndex to. (required)\n */\nexport function move<T>(array: T[], moveIndex: number, toIndex: number) {\n  const { length } = array;\n  if (moveIndex < 0 || moveIndex >= length || toIndex < 0 || toIndex >= length) {\n    return array;\n  }\n  const item = array[moveIndex] as T;\n  const diff = moveIndex - toIndex;\n\n  if (diff > 0) {\n    // move left\n    return [\n      ...array.slice(0, toIndex),\n      item,\n      ...array.slice(toIndex, moveIndex),\n      ...array.slice(moveIndex + 1, length),\n    ];\n  }\n  if (diff < 0) {\n    // move right\n    return [\n      ...array.slice(0, moveIndex),\n      ...array.slice(moveIndex + 1, toIndex + 1),\n      item,\n      ...array.slice(toIndex + 1, length),\n    ];\n  }\n  return array;\n}\n\n/**\n * Parse lodash-style path string\n * @locale {en} Parse lodash-style path string\n * @locale {zh} 解析 lodash 风格的路径字符串\n * @param {string} pathStr - 例如 'a[0].b.c'\n * @returns {string[]} - 例如 ['a', '0', 'b', 'c']\n */\nexport function parsePath(pathStr: string): string[] {\n  const pathRegex = /\\[(\\d+)\\]|\\.?([a-zA-Z0-9_]+)/g;\n  const result: string[] = [];\n  let match: RegExpExecArray | null = null;\n  while ((match = pathRegex.exec(pathStr)) !== null) {\n    result.push(match[1] || match[2]!);\n  }\n  return result;\n}\n\n/**\n * Immutably set deep property value of an object\n * @locale {en} Immutably set deep property value of an object\n * @locale {zh} 不可变地设置对象深层属性值\n * @param {T} originalValue - 原始对象或数组\n * @param {string | string[]} path - lodash 风格的路径\n * @param {T} valueToSet - 要设置的新值\n * @returns {T} - 返回一个全新的对象或数组\n */\nexport const immutableSet = <T>(\n  originalValue: T,\n  path: string | string[],\n  valueToSet: unknown,\n  defaultValue?: T,\n): T => {\n  const keys = Array.isArray(path) ? path : parsePath(path);\n\n  if (keys.length === 0) {\n    return valueToSet as T;\n  }\n\n  if (originalValue === undefined) {\n    originalValue = defaultValue as T;\n  }\n  if (!(originalValue instanceof Object)) {\n    throw new Error(`immutableSet path: ${path}: originalValue must be an object or array`);\n  }\n\n  // shallow clone originalValue\n  // Object.is(newValue, originalValue) --> false\n  // Object.is(newValue[xxx], originalValue[xxx]) --> true\n  const newValue: T = Array.isArray(originalValue)\n    ? Object.keys(originalValue).reduce((acc, key) => {\n        // @ts-expect-error supress any type error\n        acc[key] = originalValue[key];\n        return acc;\n      }, [] as T)\n    : Object.assign({}, originalValue);\n\n  let current: unknown = newValue;\n\n  for (let i = 0; i < keys.length - 1; i++) {\n    const key = keys[i]!;\n    const nextKey = keys[i + 1] || '';\n\n    // @ts-expect-error supress any type error\n    const nextNode = current[key];\n\n    let newNode: unknown;\n    if (Number.isInteger(parseInt(nextKey)) || Array.isArray(nextNode)) {\n      newNode = [];\n      if (nextNode) {\n        Object.keys(nextNode).forEach((key) => {\n          // @ts-expect-error supress any type error\n          newNode[key] = nextNode[key];\n        });\n      }\n    } else {\n      newNode = typeof nextNode === 'object' && nextNode !== null ? { ...nextNode } : {};\n    }\n\n    // @ts-expect-error supress any type error\n    current[key] = newNode;\n    current = newNode;\n  }\n\n  const lastKey = keys[keys.length - 1]!;\n  // @ts-expect-error supress any type error\n  current[lastKey] = valueToSet;\n\n  return newValue;\n};\n\n/**\n * Get all paths in an object, each path is a lodash-style array\n * @param obj The object to analyze\n * @returns Array containing all paths, excluding the root path\n */\nexport function getAllPaths(obj: Readonly<object>, excludes?: RegExp): Array<string[]> {\n  const result: Array<string[]> = [];\n\n  function traverse(currentObj: Readonly<unknown> | undefined, currentPath: string[] = []) {\n    if (currentPath.length > 0) {\n      result.push([...currentPath]);\n    }\n\n    if (currentObj !== null && typeof currentObj === 'object') {\n      if (Array.isArray(currentObj)) {\n        currentObj.forEach((item, index) => {\n          if (excludes && excludes.test(index.toString())) {\n            return;\n          }\n          const newPath = [...currentPath, index.toString()];\n          traverse(item, newPath);\n        });\n      } else {\n        for (const key in currentObj) {\n          if (Object.prototype.hasOwnProperty.call(currentObj, key)) {\n            if (excludes && excludes.test(key)) {\n              continue;\n            }\n            const newPath = [...currentPath, key];\n            // @ts-expect-error supress any type error\n            traverse(currentObj[key], newPath);\n          }\n        }\n      }\n    }\n  }\n\n  traverse(obj);\n  return result;\n}\n"],"mappings":"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","ignoreList":[]}