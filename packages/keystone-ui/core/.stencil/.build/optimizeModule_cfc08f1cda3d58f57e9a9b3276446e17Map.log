{"version":3,"names":["Slot","opt","rootname","slotname","filter","target","name","originalConnectedCallback","connectedCallback","originalDisconnectedCallback","disconnectedCallback","this","Error","undefined","Set","add","MutationObserver","mutations","forEach","mutation","children","findSlottedEl","child","slot","has","forceUpdate","observe","childList","subtree","call","disconnect","Object","defineProperty","get","slots","childNodes","nodeType","Node","ELEMENT_NODE","push","rootEl","Array","from","addedNodes","removedNodes","parentElement"],"sources":["src/utils/decorators/slot.ts"],"sourcesContent":["import { forceUpdate, ComponentInterface } from '@stencil/core';\nexport type SlotName = '_default' | string;\nexport type Slots<T = HTMLElement> = T[];\nexport type AllSlots = Record<string, Slots>;\nexport function Slot(opt?: { rootname?: string; slotname?: SlotName; filter?: (node?: Element) => boolean }) {\n  const rootname = opt?.rootname || 'el';\n  const slotname = opt?.slotname || '_default';\n  const filter = opt?.filter || (() => true);\n  return (target: ComponentInterface, name: string) => {\n    // 通过 `Object.defineProperty` 添加属性，是为了保证在使用属性时能够正确获取到target[rootname]。【时机问题】\n    const originalConnectedCallback = target.connectedCallback;\n    const originalDisconnectedCallback = target.disconnectedCallback;\n\n    target.connectedCallback = function () {\n      if (!this[rootname]) {\n        throw new Error('组件内使用Slot需要指定@Element el根节点');\n      }\n      if (this['__slots__'] === undefined) {\n        this['__slots__'] = new Set([slotname]);\n      } else {\n        this['__slots__'].add(slotname);\n      }\n      if (!this['__mutationObserver__'] && this[rootname]) {\n        this['__mutationObserver__'] = new MutationObserver((mutations) => {\n          mutations.forEach((mutation) => {\n            const children = findSlottedEl(mutation, this[rootname]) || [];\n            for (const child of children) {\n              const slot = (child as HTMLElement)?.slot || '_default';\n              if (this['__slots__'].has(slot)) {\n                // 监听到子节点增删，触发渲染、更新视图逻辑\n                forceUpdate(this[rootname]); // forceUpdate会触发render【只能在shadow 为 true的组件中使用slot装饰器】\n                break;\n              }\n            }\n          });\n        });\n      }\n\n      this['__mutationObserver__'].observe(this[rootname], { childList: true, subtree: true });\n\n      originalConnectedCallback?.call(this);\n    };\n\n    target.disconnectedCallback = function () {\n      this['__mutationObserver__']?.disconnect();\n      this['__mutationObserver__'] = undefined;\n\n      originalDisconnectedCallback?.call(this);\n    };\n\n    Object.defineProperty(target, name, {\n      get(): AllSlots | Slots {\n        const slots = {};\n        for (const child of this[rootname]?.childNodes || []) {\n          if (child.nodeType === Node.ELEMENT_NODE && filter?.(child)) {\n            const slot = child.slot || '_default';\n            // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n            slots[slot] ? slots[slot].push(child) : (slots[slot] = [child]);\n          }\n        }\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        return slots[slotname];\n      },\n    });\n  };\n}\n\n// @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\nfunction findSlottedEl(mutation: MutationRecord, rootEl: HTMLElement) {\n  let { target } = mutation;\n  if (target === rootEl) {\n    return [...Array.from(mutation.addedNodes), ...Array.from(mutation.removedNodes)];\n  } else {\n    while (target !== rootEl) {\n      if (!target) {\n        return [];\n      }\n      if (target.parentElement === rootEl) {\n        return [target];\n      } else {\n        // @ts-expect-error TYPE_FIXME. Please Fix the below strict mode type error. Read https://bytedance.sg.larkoffice.com/docx/MIsKdGOQwoQsnuxrsxEl6AsYgCf\n        target = target.parentElement;\n      }\n    }\n  }\n}\n"],"mappings":"+BAIM,SAAUA,EAAKC,GACnB,MAAMC,EAAWD,GAAKC,UAAY,KAClC,MAAMC,EAAWF,GAAKE,UAAY,WAClC,MAAMC,EAASH,GAAKG,QAAM,KAAW,MACrC,MAAO,CAACC,EAA4BC,KAElC,MAAMC,EAA4BF,EAAOG,kBACzC,MAAMC,EAA+BJ,EAAOK,qBAE5CL,EAAOG,kBAAoB,WACzB,IAAKG,KAAKT,GAAW,CACnB,MAAM,IAAIU,MAAM,8B,CAElB,GAAID,KAAK,eAAiBE,UAAW,CACnCF,KAAK,aAAe,IAAIG,IAAI,CAACX,G,KACxB,CACLQ,KAAK,aAAaI,IAAIZ,E,CAExB,IAAKQ,KAAK,yBAA2BA,KAAKT,GAAW,CACnDS,KAAK,wBAA0B,IAAIK,kBAAkBC,IACnDA,EAAUC,SAASC,IACjB,MAAMC,EAAWC,EAAcF,EAAUR,KAAKT,KAAc,GAC5D,IAAK,MAAMoB,KAASF,EAAU,CAC5B,MAAMG,EAAQD,GAAuBC,MAAQ,WAC7C,GAAIZ,KAAK,aAAaa,IAAID,GAAO,CAE/BE,EAAYd,KAAKT,IACjB,K,KAGJ,G,CAINS,KAAK,wBAAwBe,QAAQf,KAAKT,GAAW,CAAEyB,UAAW,KAAMC,QAAS,OAEjFrB,GAA2BsB,KAAKlB,KAClC,EAEAN,EAAOK,qBAAuB,WAC5BC,KAAK,yBAAyBmB,aAC9BnB,KAAK,wBAA0BE,UAE/BJ,GAA8BoB,KAAKlB,KACrC,EAEAoB,OAAOC,eAAe3B,EAAQC,EAAM,CAClC,GAAA2B,GACE,MAAMC,EAAQ,GACd,IAAK,MAAMZ,KAASX,KAAKT,IAAWiC,YAAc,GAAI,CACpD,GAAIb,EAAMc,WAAaC,KAAKC,cAAgBlC,IAASkB,GAAQ,CAC3D,MAAMC,EAAOD,EAAMC,MAAQ,WAE3BW,EAAMX,GAAQW,EAAMX,GAAMgB,KAAKjB,GAAUY,EAAMX,GAAQ,CAACD,E,EAI5D,OAAOY,EAAM/B,E,GAEf,CAEN,CAGA,SAASkB,EAAcF,EAA0BqB,GAC/C,IAAInC,OAAEA,GAAWc,EACjB,GAAId,IAAWmC,EAAQ,CACrB,MAAO,IAAIC,MAAMC,KAAKvB,EAASwB,eAAgBF,MAAMC,KAAKvB,EAASyB,c,KAC9D,CACL,MAAOvC,IAAWmC,EAAQ,CACxB,IAAKnC,EAAQ,CACX,MAAO,E,CAET,GAAIA,EAAOwC,gBAAkBL,EAAQ,CACnC,MAAO,CAACnC,E,KACH,CAELA,EAASA,EAAOwC,a,GAIxB,Q","ignoreList":[]}